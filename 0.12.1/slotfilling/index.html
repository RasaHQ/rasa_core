
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Slot Filling</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/banner.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Bot Responses" href="../responses/" />
    <link rel="prev" title="Using Slots" href="../slots/" />

 <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MMHSZCS');</script>
    <!-- End Google Tag Manager -->
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  <meta itemprop="image" content="https://rasa.com/assets/img/facebook-og.png">
  <meta property="og:title" content="Slot Filling" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rasa.com/assets/img/facebook-og.png" />
  <meta property="og:url" content="https://rasa.com/docs/core/slotfilling" />
  
    <meta name="description" content="None" />
    <meta itemprop="description" content="None">
    <meta name="twitter:description" content="None" />
    <meta property="og:description" content="None" />
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Rasa_HQ">
  <meta name="twitter:title" content="Slot Filling">
  <meta name="twitter:creator" content="@Rasa_HQ">
  <meta name="twitter:image" content="https://rasa.com/assets/img/facebook-og.png">

  <link rel="stylesheet" href="../_static/xq-light.css" type="text/css" />
  <link rel="stylesheet" href="../_static/fontawesome/css/fontawesome-all.css" type="text/css" />
  <!--<script defer type="text/javascript" src="../_static/config.js"></script>
  <script defer type="text/javascript" src="../_static/klaro.js"></script>-->
  <script type="text/javascript" src="https://storage.googleapis.com/docs-theme/clipboard.min.js"></script>
  
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head><body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MMHSZCS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="nav-top">
  <div class="nav-container">
    <a href="/docs" class="brand-link">
        <h1 class="brand">
            <img src="../_static/rasa_logo.svg" width="80px" height="40px" title="Rasa logo" alt="Rasa logo">
        </h1>
        <span class="logo extension">docs</span>
    </a>

    <ul class="nav">
      <input type="text" class="search" placeholder="Search">
      
        
          <li><a href=/docs/nlu/>NLU</a></li>
        
      
        
          <li class="active"><a href=/docs/core/>Core</a></li>
        
      
        
          <li><a href=/docs/platform/>Platform</a></li>
        
      

      <li>
        <a href="https://forum.rasa.com" target="_blank"><button class="button btn-ghost btn-small">Ask the Community</button></a>
      </li>

    </ul>
  </div>
</div>

  <div class="sidebar-extended"></div>
  <div class="document">

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../architecture/">High-Level Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors/">Chat &amp; Voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customactions/">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slots/">Using Slots</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Slot Filling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../responses/">Bot Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fallbacks/">Fallback Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Training and Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evaluation/">Evaluating and Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker_walkthrough/">Development with Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domain Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stories/">Story Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/slots_api/">Slot Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tracker/">Dialogue State Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/interpreter/">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/policy/">Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/featurizer/">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/dispatcher/">Dispatcher</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migrations/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tracker_stores/">Tracker Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../brokers/">Event Brokers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/">Using Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/">Getting Support</a></li>
</ul>

<div class="versions">
    <p class="caption">Versions</p>
    <div class="versions-content">
      <div>
        <span class="current-version">
          viewing: 0.12.1
        </span>
      </div>
      <div class="other-versions">
          <p>tags</p>
          <div class="dropdown-content">
              <a href="../../0.12.2/slotfilling/">0.12.2</a>
              <a href="../../0.12.1/slotfilling/">0.12.1</a>
              <a href="../../0.12.0/slotfilling/">0.12.0</a>
              <a href="../../0.11.12/slotfilling/">0.11.12</a>
              <a href="../../0.10.4/slotfilling/">0.10.4</a>
              <a href="../../0.9.8/index/">0.9.8</a>
              <a href="../../0.8.6/index/">0.8.6</a>
              <a href="../../0.7.9/index/">0.7.9</a>
              <a href="../../0.6.9/index/">0.6.9</a>
          </div>
          <p>branches</p>
          <div class="dropdown-content">
              <a href="../../master/slotfilling/">master</a>
          </div>
      </div>
    </div>
</div>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  


    
    



    <p class="scv-banner"><a href="../../0.12.2/slotfilling/"><b>Warning:</b> This document is for an old version of Rasa Core. The latest version is 0.12.2.</a></p>
<div class="section" id="slot-filling">
<span id="slotfilling"></span><h1><a class="toc-backref" href="#id1">Slot Filling</a><a class="headerlink" href="#slot-filling" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#slot-filling" id="id1">Slot Filling</a><ul>
<li><a class="reference internal" href="#basics" id="id2">Basics</a></li>
<li><a class="reference internal" href="#custom-slot-mappings" id="id3">Custom slot mappings</a></li>
<li><a class="reference internal" href="#validating-user-input" id="id4">Validating user input</a></li>
<li><a class="reference internal" href="#handling-unhappy-paths" id="id5">Handling unhappy paths</a></li>
<li><a class="reference internal" href="#the-requested-slot-slot" id="id6">The requested_slot slot</a></li>
<li><a class="reference internal" href="#handling-conditional-slot-logic" id="id7">Handling conditional slot logic</a></li>
<li><a class="reference internal" href="#debugging" id="id8">Debugging</a></li>
<li><a class="reference internal" href="#have-questions-or-feedback" id="id9">Have questions or feedback?</a></li>
</ul>
</li>
</ul>
</div>
<p>One of the most common conversation patterns is to collect a few pieces of
information from a user in order to do something (book a restaurant, call an
API, search a database, etc.). This is also called <strong>slot filling</strong>.</p>
<p>If you need to collect multiple pieces of information in a row, we recommended
that you create a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code>. This is a single action which contains the
logic to loop over the required slots and ask the user for this information.
There is a full example using forms in the <code class="docutils literal notranslate"><span class="pre">examples/formbot</span></code> directory of
Rasa Core.</p>
<p>You can take a look at the FormAction base class by clicking this link:</p>
<dl class="class">
<dt id="rasa_core_sdk.forms.FormAction">
<em class="property">class </em><code class="descclassname">rasa_core_sdk.forms.</code><code class="descname">FormAction</code><a class="reference internal" href="../_modules/rasa_core_sdk/forms/#FormAction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#rasa_core_sdk.forms.FormAction" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="section" id="basics">
<span id="section-form-basics"></span><h2><a class="toc-backref" href="#id2">Basics</a><a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>Using a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code>, you can describe <em>all</em> of the happy paths with a single
story. By “happy path”, we mean that whenever you ask a user for some information,
they respond with what you asked for.</p>
<p>If we take the example of the restaurant bot, this single story describes all of the
happy paths.</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span><span class="gh">## happy path</span>
<span class="vm">* request_restaurant</span>
<span class="vm">    </span>- restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FormAction</span></code> will only requests slots which haven’t already been set.
If a user says
“I’d like a vegetarian Chinese restaurant for 8 people”, they won’t be
asked about the <code class="docutils literal notranslate"><span class="pre">cuisine</span></code> and <code class="docutils literal notranslate"><span class="pre">num_people</span></code> slots.</p>
<p>Note that for this story to work, your slots should be <a class="reference external" href="https://rasa.com/docs/core/api/slots_api/#unfeaturized-slot">unfeaturized</a>.
If they’re not, you should add all the slots that have been set by the form.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">restaurant_form</span></code> in the story above is the name of our form action.
Here is an example of what it looks like.
You need to define three methods:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of this action</li>
<li><code class="docutils literal notranslate"><span class="pre">required_slots</span></code>: a list of slots that need to be filled for the <code class="docutils literal notranslate"><span class="pre">submit</span></code> method to work.</li>
<li><code class="docutils literal notranslate"><span class="pre">submit</span></code>: what to do at the end of the form, when all the slots have been filled.</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RestaurantForm</span><span class="p">(</span><span class="n">FormAction</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Example of a custom form action&quot;&quot;&quot;</span>

   <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="c1"># type: () -&gt; Text</span>
       <span class="sd">&quot;&quot;&quot;Unique identifier of the form&quot;&quot;&quot;</span>

       <span class="k">return</span> <span class="s2">&quot;restaurant_form&quot;</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">required_slots</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
       <span class="c1"># type: () -&gt; List[Text]</span>
       <span class="sd">&quot;&quot;&quot;A list of required slots that the form has to fill&quot;&quot;&quot;</span>

       <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;num_people&quot;</span><span class="p">,</span> <span class="s2">&quot;outdoor_seating&quot;</span><span class="p">,</span>
               <span class="s2">&quot;preferences&quot;</span><span class="p">,</span> <span class="s2">&quot;feedback&quot;</span><span class="p">]</span>

   <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
       <span class="c1"># type: (CollectingDispatcher, Tracker, Dict[Text, Any]) -&gt; List[Dict]</span>
       <span class="sd">&quot;&quot;&quot;Define what the form has to do</span>
<span class="sd">           after all required slots are filled&quot;&quot;&quot;</span>

       <span class="c1"># utter submit template</span>
       <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_template</span><span class="p">(</span><span class="s1">&#39;utter_submit&#39;</span><span class="p">,</span> <span class="n">tracker</span><span class="p">)</span>
       <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Once the form action gets called for the first time,
the form gets activated and the <code class="docutils literal notranslate"><span class="pre">FormPolicy</span></code> jumps in.
The <code class="docutils literal notranslate"><span class="pre">FormPolicy</span></code> is extremely simple and just always predicts the form action.
See <a class="reference internal" href="#section-unhappy"><span class="std std-ref">Handling unhappy paths</span></a> for how to work with unexpected user input.</p>
<p>Every time the form action gets called, it will ask the user for the next slot in
<code class="docutils literal notranslate"><span class="pre">required_slots</span></code> which is not already set.
It does this by looking for a template called <code class="docutils literal notranslate"><span class="pre">utter_ask_{slot_name}</span></code>,
so you need to define these in your domain file for each required slot.</p>
<p>Once all the slots are filled, the <code class="docutils literal notranslate"><span class="pre">submit()</span></code> method is called, where you can
use the information you’ve collected to do something for the user, for example
querying a restaurant API.
If you don’t want your form to do anything at the end, just use <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">[]</span></code>
as your submit method.
After the submit method is called, the form is deactivated,
and other policies in your Core model will be used to predict the next action.</p>
</div>
<div class="section" id="custom-slot-mappings">
<h2><a class="toc-backref" href="#id3">Custom slot mappings</a><a class="headerlink" href="#custom-slot-mappings" title="Permalink to this headline">¶</a></h2>
<p>Some slots (like <code class="docutils literal notranslate"><span class="pre">cuisine</span></code>) can be picked up using a single entity, but a
<code class="docutils literal notranslate"><span class="pre">FormAction</span></code> can also support yes/no questions and free-text input.
The <code class="docutils literal notranslate"><span class="pre">slot_mapping</span></code> method defines how to extract slot values from user responses.</p>
<p>Here’s an example for the restaurant bot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">slot_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># type: () -&gt; Dict[Text: Union[Text, Dict, List[Text, Dict]]]</span>
    <span class="sd">&quot;&quot;&quot;A dictionary to map required slots to</span>
<span class="sd">        - an extracted entity</span>
<span class="sd">        - intent: value pairs</span>
<span class="sd">        - a whole message</span>
<span class="sd">        or a list of them, where the first match will be picked&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_entity</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span>
                                        <span class="n">intent</span><span class="o">=</span><span class="s2">&quot;inform&quot;</span><span class="p">),</span>
            <span class="s2">&quot;num_people&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_entity</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">),</span>
            <span class="s2">&quot;outdoor_seating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">from_entity</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="s2">&quot;seating&quot;</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">from_intent</span><span class="p">(</span><span class="n">intent</span><span class="o">=</span><span class="s1">&#39;affirm&#39;</span><span class="p">,</span>
                                                 <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">from_intent</span><span class="p">(</span><span class="n">intent</span><span class="o">=</span><span class="s1">&#39;deny&#39;</span><span class="p">,</span>
                                                 <span class="n">value</span><span class="o">=</span><span class="bp">False</span><span class="p">)],</span>
            <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="n">intent</span><span class="o">=</span><span class="s1">&#39;inform&#39;</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">from_intent</span><span class="p">(</span><span class="n">intent</span><span class="o">=</span><span class="s1">&#39;deny&#39;</span><span class="p">,</span>
                                             <span class="n">value</span><span class="o">=</span><span class="s2">&quot;no additional &quot;</span>
                                                   <span class="s2">&quot;preferences&quot;</span><span class="p">)],</span>
            <span class="s2">&quot;feedback&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">from_entity</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="s2">&quot;feedback&quot;</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">from_text</span><span class="p">()]}</span>
</pre></div>
</div>
<p>The predefined functions work as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.from_entity(entity=entity_name,</span> <span class="pre">intent=intent_name)</span></code>
will look for an entity called <code class="docutils literal notranslate"><span class="pre">entity_name</span></code> to fill a slot
<code class="docutils literal notranslate"><span class="pre">slot_name</span></code> regardless of user intent if <code class="docutils literal notranslate"><span class="pre">intent_name</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>
else only if the users intent is <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">self.from_intent(intent=intent_name,</span> <span class="pre">value=value)</span></code>
will fill slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code> with <code class="docutils literal notranslate"><span class="pre">value</span></code> if user intent is <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.
To make a boolean slot, take a look at the definition of <code class="docutils literal notranslate"><span class="pre">outdoor_seating</span></code>
above.</li>
<li><code class="docutils literal notranslate"><span class="pre">self.from_text(intent=intent_name)</span></code> will use the next
user utterance to fill the text slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code> regardless of user intent
if <code class="docutils literal notranslate"><span class="pre">intent_name</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> else only if user intent is <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.</li>
<li>If you want to allow a combination of these, provide them as a list as in the
example above</li>
</ul>
</div>
<div class="section" id="validating-user-input">
<h2><a class="toc-backref" href="#id4">Validating user input</a><a class="headerlink" href="#validating-user-input" title="Permalink to this headline">¶</a></h2>
<p>After extracting a slot value from user input, the form will try to validate the
value of the slot. By default, this only checks if the requested slot was extracted.
If you want to add custom validation, for example to check a value against a database,
you can do this by overwriting the <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method.
Here is an example which checks if the extracted cuisine slot belongs to a
list of supported cuisines.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">cuisine_db</span><span class="p">():</span>
    <span class="c1"># type: () -&gt; List[Text]</span>
    <span class="sd">&quot;&quot;&quot;Database of supported cuisines&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;caribbean&quot;</span><span class="p">,</span> <span class="s2">&quot;chinese&quot;</span><span class="p">,</span> <span class="s2">&quot;french&quot;</span><span class="p">,</span> <span class="s2">&quot;greek&quot;</span><span class="p">,</span> <span class="s2">&quot;indian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;italian&quot;</span><span class="p">,</span> <span class="s2">&quot;mexican&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
    <span class="c1"># type: (CollectingDispatcher, Tracker, Dict[Text, Any]) -&gt; List[Dict]</span>
    <span class="sd">&quot;&quot;&quot;&quot;Validate extracted requested slot else raise an error&quot;&quot;&quot;</span>
    <span class="n">slot_to_fill</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="n">REQUESTED_SLOT</span><span class="p">)</span>

    <span class="c1"># extract requested slot from a user input by using `slot_mapping`</span>
    <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># raise an error if nothing was extracted</span>
        <span class="k">raise</span> <span class="n">ActionExecutionRejection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
                                       <span class="s2">&quot;Failed to validate slot {0} &quot;</span>
                                       <span class="s2">&quot;with action {1}&quot;</span>
                                       <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slot_to_fill</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">()))</span>

    <span class="n">extracted_slots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">validated_events</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;slot&#39;</span><span class="p">:</span>
            <span class="c1"># get values of extracted slots to validate them later</span>
            <span class="n">extracted_slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># add other events without validating them</span>
            <span class="n">validated_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">extracted_slots</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">slot_to_fill</span> <span class="o">==</span> <span class="s1">&#39;cuisine&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuisine_db</span><span class="p">():</span>
                <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_template</span><span class="p">(</span><span class="s1">&#39;utter_wrong_cuisine&#39;</span><span class="p">,</span> <span class="n">tracker</span><span class="p">)</span>
                <span class="c1"># validation failed, set this slot to None, meaning the</span>
                <span class="n">user</span> <span class="n">will</span> <span class="n">be</span> <span class="n">asked</span> <span class="k">for</span> <span class="n">the</span> <span class="n">slot</span> <span class="n">again</span>
                <span class="n">validated_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SlotSet</span><span class="p">(</span><span class="n">slot_to_fill</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># validation succeeded</span>
                <span class="n">validated_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SlotSet</span><span class="p">(</span><span class="n">slot_to_fill</span><span class="p">,</span> <span class="n">slot</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no validation needed</span>
            <span class="n">validated_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SlotSet</span><span class="p">(</span><span class="n">slot_to_fill</span><span class="p">,</span> <span class="n">slot</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">validated_events</span>
</pre></div>
</div>
<p>If nothing is extracted from the user’s utterance for any of the required slots, an
<code class="docutils literal notranslate"><span class="pre">ActionExecutionRejection</span></code> error will be raised, meaning the action execution
was rejected and therefore Core will fall back onto a different policy to
predict another action.</p>
</div>
<div class="section" id="handling-unhappy-paths">
<span id="section-unhappy"></span><h2><a class="toc-backref" href="#id5">Handling unhappy paths</a><a class="headerlink" href="#handling-unhappy-paths" title="Permalink to this headline">¶</a></h2>
<p>Of course your users will not always respond with the information you ask of them.
Typically, users will ask questions, make chitchat, change their mind, or otherwise
stray from the happy path. The way this works with forms is that a form will raise
an <code class="docutils literal notranslate"><span class="pre">ActionExecutionRejection</span></code> if the user didn’t provide the requested information.
You need to handle events that might cause <code class="docutils literal notranslate"><span class="pre">ActionExecutionRejection</span></code> errors
in your stories. For example, if you expect your users to chitchat with your bot,
you could add a story like this:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span><span class="gh">## chitchat</span>
<span class="vm">* request_restaurant</span>
<span class="vm">    </span>- restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
<span class="vm">* chitchat</span>
<span class="vm">    </span>- utter_chitchat
    - restaurant_form
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>It is <strong>strongly</strong> recommended that you build these stories using interactive learning.
If you write these stories by hand you will likely miss important things.
Please read <a class="reference internal" href="../interactive_learning/#section-interactive-learning-forms"><span class="std std-ref">Interactive Learning with Forms</span></a>
on how to use interactive learning with forms.</p>
</div>
<div class="section" id="the-requested-slot-slot">
<h2><a class="toc-backref" href="#id6">The requested_slot slot</a><a class="headerlink" href="#the-requested-slot-slot" title="Permalink to this headline">¶</a></h2>
<p>The slot <code class="docutils literal notranslate"><span class="pre">requested_slot</span></code> is automatically added to the domain as an
unfeaturized slot. If you want to make it featurized, you need to add it
to your domain file as a categorical slot. You might want to do this if you
want to handle your unhappy paths differently depending on what slot is
currently being asked from the user. For example, say your users respond
to one of the bot’s questions with another question, like <em>why do you need to know that?</em>
The response to this <code class="docutils literal notranslate"><span class="pre">explain</span></code> intent depends on where we are in the story.
In the restaurant case, your stories would look something like this:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span><span class="gh">## explain cuisine slot</span>
<span class="vm">* request_restaurant</span>
<span class="vm">    </span>- restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
<span class="o">    - slot</span><span class="p">{</span><span class="nt">&quot;requested_slot&quot;</span><span class="p">:</span> <span class="s2">&quot;cuisine&quot;</span><span class="p">}</span>
<span class="vm">* explain</span>
<span class="vm">    </span>- utter_explain_cuisine
    - restaurant_form
<span class="o">    - slot</span><span class="p">{</span><span class="nt">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;greek&quot;</span><span class="p">}</span>
    ( ... all other slots the form set ... )
    - form{&quot;name&quot;: null}

<span class="gh">## explain num_people slot</span>
<span class="vm">* request_restaurant</span>
<span class="vm">    </span>- restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
<span class="o">    - slot</span><span class="p">{</span><span class="nt">&quot;requested_slot&quot;</span><span class="p">:</span> <span class="s2">&quot;num_people&quot;</span><span class="p">}</span>
<span class="vm">* explain</span>
<span class="vm">    </span>- utter_explain_num_people
    - restaurant_form
<span class="o">    - slot</span><span class="p">{</span><span class="nt">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;greek&quot;</span><span class="p">}</span>
    ( ... all other slots the form set ... )
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>Again, is is <strong>strongly</strong> recommended that you use interactive
learning to build these stories.
Please read <a class="reference internal" href="../interactive_learning/#section-interactive-learning-forms"><span class="std std-ref">Interactive Learning with Forms</span></a>
on how to use interactive learning with forms.</p>
</div>
<div class="section" id="handling-conditional-slot-logic">
<h2><a class="toc-backref" href="#id7">Handling conditional slot logic</a><a class="headerlink" href="#handling-conditional-slot-logic" title="Permalink to this headline">¶</a></h2>
<p>Many forms require more logic than just requesting a list of fields.
For example, if someone requests <code class="docutils literal notranslate"><span class="pre">greek</span></code> as their cuisine, you may want to
ask if they are looking for somewhere with outside seating.</p>
<p>You can achieve this by writing some logic into the <code class="docutils literal notranslate"><span class="pre">required_slots()</span></code> method,
for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">required_slots</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
   <span class="c1"># type: () -&gt; List[Text]</span>
   <span class="sd">&quot;&quot;&quot;A list of required slots that the form has to fill&quot;&quot;&quot;</span>

   <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;cuisine&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;greek&#39;</span><span class="p">:</span>
     <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;num_people&quot;</span><span class="p">,</span> <span class="s2">&quot;outdoor_seating&quot;</span><span class="p">,</span>
             <span class="s2">&quot;preferences&quot;</span><span class="p">,</span> <span class="s2">&quot;feedback&quot;</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;num_people&quot;</span><span class="p">,</span>
             <span class="s2">&quot;preferences&quot;</span><span class="p">,</span> <span class="s2">&quot;feedback&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This mechanism is quite general and you can use it to build many different
kinds of logic into your forms.</p>
</div>
<div class="section" id="debugging">
<h2><a class="toc-backref" href="#id8">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>The first thing to try is to run your bot with the <code class="docutils literal notranslate"><span class="pre">debug</span></code> flag, see <a class="reference internal" href="../debugging/#debugging"><span class="std std-ref">Debugging</span></a> for details.
If you are just getting started, you probably only have a few hand-written stories.
This is a great starting point, but
you should give your bot to people to test <strong>as soon as possible</strong>. One of the guiding principles
behind Rasa Core is:</p>
<blockquote class="pull-quote">
<div>Learning from real conversations is more important than designing hypothetical ones</div></blockquote>
<p>So don’t try to cover every possibility in your hand-written stories before giving it to testers.
Real user behavior will always surprise you!</p>
</div>
<div class="section" id="have-questions-or-feedback">
<h2><a class="toc-backref" href="#id9">Have questions or feedback?</a><a class="headerlink" href="#have-questions-or-feedback" title="Permalink to this headline">¶</a></h2>
<p>We have a very active support community on <a class="reference external" href="https://forum.rasa.com">Rasa Community Forum</a>
that is happy to help you with your questions. If you have any feedback for us or a specific
suggestion for improving the docs, feel free to share it by creating an issue on Rasa Core
<a class="reference external" href="https://github.com/RasaHQ/rasa_core/issues">GitHub repository</a>.</p>
</div>
</div>


	    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
	    <script type="text/javascript"> docsearch({
	     apiKey: '1f9e0efb89e98543f6613a60f847b176',
	     indexName: 'rasa',
	     inputSelector: 'body > div.nav-top > .nav-container > .nav > input',
	     debug: false // Set debug to true if you want to inspect the dropdown
	    });
	    </script>
          </div>
          
          <div class="footer">
            
            <div class="social">
              <a href="https://github.com/RasaHQ" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
              <a href="https://stackoverflow.com/search?q=rasa" target="_blank" title="Stack Overflow"><i class="fab fa-stack-overflow"></i></a>
              <a href="https://www.youtube.com/channel/UCJ0V6493mLvqdiVwOKWBODQ" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
              <a href="https://twitter.com/rasa_hq" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
            </div>
            
            <div class="copyright small">
            &copy;2018, Rasa Technologies GmbH | <a href="https://rasa.com/imprint/" target="_blank">Imprint</a> | <a href="https://rasa.com/privacy-policy/" target="_blank">Privacy Policy</a>
            
            </div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>

    

  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag(...arguments) {
      dataLayer.push(...arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-87333416-1', {
      'anonymize_ip': true,
    });
  </script>
  <script src="https://rasa.com/assets/js/js.cookies.js"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- TODO: Re-Enable once Klaro is re-activated again. Remove the next two lines, then.
  <script type="opt-in" data-name="googleanalytics" data-type="text/javascript" data-src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script type="opt-in" data-name="googleanalytics" data-type="text/javascript" data-src="https://rasa.com/assets/js/userId.js"></script>
  -->
  <script src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script src="https://rasa.com/assets/js/userId.js"></script>
  <script type="text/javascript">
    var clipboard = new ClipboardJS('.copyable');
    clipboard.on('success', function(e) {
      gtag('event', e.action, {
        'event_category': 'code',
        'event_label': e.text
      });
      const id = e.text.slice(0,3);
      document.getElementById(id).classList.add('visible');
      setTimeout(function(){
        document.getElementById(id).classList.remove('visible');},
        800
      );
    });
    clipboard.on('error', function(e) {
      console.log(e);
    });
  </script>

  <!-- onsite anchor fix (otherwise anchors scroll to far) -->
  <script>
    /* Adapted from https://stackoverflow.com/a/13067009/1906073 */
    (function(document, history, location) {
      var HISTORY_SUPPORT = !!(history && history.pushState);

      var anchorScrolls = {
        ANCHOR_REGEX: /^#[^ ]+$/,
        OFFSET_HEIGHT_PX: 66,

        /**
         * Establish events, and fix initial scroll position if a hash is provided.
         */
        init: function() {
          this.scrollToCurrent();
          $(window).on('hashchange', $.proxy(this, 'scrollToCurrent'));
          $('body').on('click', 'a', $.proxy(this, 'delegateAnchors'));
        },

        /**
         * Return the offset amount to deduct from the normal scroll position.
         * Modify as appropriate to allow for dynamic calculations
         */
        getFixedOffset: function() {
          return this.OFFSET_HEIGHT_PX;
        },

        /**
         * If the provided href is an anchor which resolves to an element on the
         * page, scroll to it.
         * @param  {String} href
         * @return {Boolean} - Was the href an anchor.
         */
        scrollIfAnchor: function(href, pushToHistory) {
          var match, anchorOffset;

          if(!this.ANCHOR_REGEX.test(href)) {
            return false;
          }

          match = document.getElementById(href.slice(1));

          if(match) {
            anchorOffset = $(match).offset().top - this.getFixedOffset();
            $('html, body').animate({ scrollTop: anchorOffset});

            // Add the state to history as-per normal anchor links
            if(HISTORY_SUPPORT && pushToHistory) {
              history.pushState({}, document.title, location.pathname + href);
            }
          }

          return !!match;
        },

        /**
         * Attempt to scroll to the current location's hash.
         */
        scrollToCurrent: function(e) {
          if(this.scrollIfAnchor(window.location.hash) && e) {
            e.preventDefault();
          }
        },

        /**
         * If the click event's target was an anchor, fix the scroll position.
         */
        delegateAnchors: function(e) {
          var elem = e.target;

          if(this.scrollIfAnchor(elem.getAttribute('href'), true)) {
            e.preventDefault();
          }
        }
      };

      $(document).ready($.proxy(anchorScrolls, 'init'));
    })(window.document, window.history, window.location);

  </script>
  <div id="webchat">
  <script src="https://storage.googleapis.com/mrbot-cdn/webchat-0.4.2.js"></script>
  <script>
   WebChat.default.init({
       selector: "#webchat",
       initPayload: "/greet",
       interval: 150,
       socketUrl: "https://website-demo.rasa.com/",
       title: "Sara",
       subtitle: "I'm still in development",
       profileAvatar: "https://rasa.com/assets/img/demo/sara_avatar.png",
       showCloseButton: true,
       fullScreenMode: false,})
  </script>
  </div>
  </body>
</html>