

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A Bot From Scratch &mdash; Rasa Core 0.7.0a3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rasa Core 0.7.0a3 documentation" href="index.html"/>
        <link rel="next" title="Supervised Learning Tutorial" href="tutorial_babi.html"/>
        <link rel="prev" title="A Quick Tour (no ML)" href="tour.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rasa Core
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="read_first.html">Read this first</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Hello World</a></li>
<li class="toctree-l1"><a class="reference internal" href="tour.html">A Quick Tour (no ML)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">A Bot From Scratch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-bot">The Bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-domain">The Domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stateless-stories">Stateless Stories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training">Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-learning">Interactive Learning</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">More Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial_babi.html">Supervised Learning Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_fake_user.html">Interactive Learning with a Fake User</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Dives</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="slot_types.html">Slot Types Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="plumbing.html">Plumbing - How it all fits together</a></li>
<li class="toctree-l1"><a class="reference internal" href="connectors.html">Connecting to messaging &amp; voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="domains_actions.html">Domains and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="state.html">Tracking Conversation State</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies.html">Creating Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="stories.html">Stories Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling Reminders</a></li>
<li class="toctree-l1"><a class="reference internal" href="featurisation.html">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpreters.html">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_handling.html">Message Handling</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="library.html">Library Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rasa Core</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>A Bot From Scratch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial_scratch.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="a-bot-from-scratch">
<span id="tutorial-scratch"></span><h1>A Bot From Scratch<a class="headerlink" href="#a-bot-from-scratch" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is the place to start if you have a great idea for a bot but you don&#8217;t have any conversations to use as training data. We will assume that you&#8217;ve already thought of what intents and entities you need (check out the Rasa NLU docs if you don&#8217;t know what those are).</p>
</div>
<div class="section" id="the-bot">
<h2>The Bot<a class="headerlink" href="#the-bot" title="Permalink to this headline">¶</a></h2>
<p>We will build a bot that can recommend concerts to go to.
We&#8217;ll show how to implement context-aware behaviour without writing a flow chart.
For example, if our user asks the question: <em>which of those has better reviews?</em>,
our bot should know whether they want to compare <em>musicians</em> or <em>venues</em>.</p>
<p>Let&#8217;s go!</p>
</div>
<div class="section" id="the-domain">
<h2>The Domain<a class="headerlink" href="#the-domain" title="Permalink to this headline">¶</a></h2>
<p>We will keep the concert domain simple, and won&#8217;t add any slots just yet.
We&#8217;ll also only support these intents:
<code class="docutils literal"><span class="pre">&quot;greet&quot;,</span> <span class="pre">&quot;thankyou&quot;,</span> <span class="pre">&quot;goodbye&quot;,</span> <span class="pre">&quot;search_concerts&quot;,</span> <span class="pre">&quot;search_venues&quot;,</span> <span class="pre">&quot;compare_reviews&quot;</span></code>
You can see the domain definition in <code class="docutils literal"><span class="pre">examples/concerts/concert_domain.yml</span></code>.</p>
</div>
<div class="section" id="stateless-stories">
<h2>Stateless Stories<a class="headerlink" href="#stateless-stories" title="Permalink to this headline">¶</a></h2>
<p>We start by training a stateless model on some simple dialogues in the Rasa story format.</p>
<p>Below is an excerpt of the stories.</p>
<p>In many cases, your bot&#8217;s &#8216;conversations&#8217; are just a single turn and response:
&#8220;Hello&#8221; is always met with a greeting, &#8220;goodbye!&#8221; is always met with a sign-off,
and the correct response to &#8220;thank you&#8221; is pretty much always &#8220;you&#8217;re welcome&#8221;.</p>
<p>Notice that below, we&#8217;ve defined two stories, showing that
<code class="docutils literal"><span class="pre">action_show_venue_reviews</span></code> and <code class="docutils literal"><span class="pre">action_show_concert_reviews</span></code>
are both possible responses to the <code class="docutils literal"><span class="pre">compare_reviews</span></code> intent, but neither references
any context. That comes later.</p>
<div class="highlight-markdown"><div class="highlight"><pre><span></span>## greet
* _greet
    - action_greet

## happy
* _thankyou
    - action_youarewelcome
...

## compare_reviews_venues
* _compare_reviews
    - action_show_venue_reviews

## compare_reviews_concerts
* _compare_reviews
    - action_show_concert_reviews
</pre></div>
</div>
</div>
<div class="section" id="training">
<h2>Training<a class="headerlink" href="#training" title="Permalink to this headline">¶</a></h2>
<p>We start by training the policy to recognise these input-output pairs independently of any context.
( You can see the definition of the ConcertPolicy class in <code class="docutils literal"><span class="pre">concert_policy.py</span></code>. )
Run the script <code class="docutils literal"><span class="pre">train_init.py</span></code>.
This creates a training set of conversations by randomly combining the
stories we&#8217;ve provided into longer dialogues, and then trains the policy on that dataset.</p>
<p>Then, run the script <code class="docutils literal"><span class="pre">run.py</span></code> to talk to the bot.
You should be able to have a conversation similar to the one below</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">we haven&#8217;t connected an NLU tool here,
so when you type messages to the bot you have to
type the intent starting with a <cite>_</cite>.
If you want to use Rasa NLU / wit.ai / Lex you
can just swap the <cite>Interpreter</cite> class in <cite>run.py</cite>.</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Bot loaded. Type hello and press enter :
_greet
hey there!
_search_concerts
Here&#39;s what I found:
Katy Perry, Foo Fighters
_goodbye
goodbye :(
</pre></div>
</div>
<p>Now we&#8217;ll train the bot to use context
to respond correctly to the <code class="docutils literal"><span class="pre">compare_reviews</span></code> intent.</p>
</div>
<div class="section" id="interactive-learning">
<h2>Interactive Learning<a class="headerlink" href="#interactive-learning" title="Permalink to this headline">¶</a></h2>
<p>Run the script <code class="docutils literal"><span class="pre">train_online.py</span></code>.
This first repeats the process in the <code class="docutils literal"><span class="pre">train_init</span></code> script, creating
a stateless policy.</p>
<p>It then runs the bot so that you can provide feedback to train it:</p>
<p><strong>Happy paths</strong></p>
<p>We can start talking to the bot as before,
directly entering the intents. For example, if we type <code class="docutils literal"><span class="pre">_greet</span></code>, we get the following prompt:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>_greet
------
Chat history:

     bot did:        action_listen

     user said:      _greet

                whose intent is:     greet

we currently have slots: <span class="o">{</span><span class="s1">&#39;location&#39;</span>: None<span class="o">}</span>

------
The bot wants to <span class="o">[</span>greet<span class="o">]</span> due to the intent. Is this correct?

    <span class="m">1</span>.       Yes
    <span class="m">2</span>.       No, intent is right but the action is wrong
    <span class="m">3</span>.       The intent is wrong
</pre></div>
</div>
<p>This gives you all the info you should hopefully need to decide
what the bot <em>should</em> have done.
In this case, the bot chose the right action (&#8216;greet&#8217;), so we type <code class="docutils literal"><span class="pre">1</span></code> and hit enter.
We continue this loop until the bot chooses the wrong action.</p>
<p><strong>Providing feedback on errors</strong></p>
<p>We&#8217;ve just asked the bot to search for concerts, and now we&#8217;re asking it to compare reviews. The bot happens to choose the wrong one out of the two possibilities we wrote in the stories:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>_compare_reviews
------
Chat history:

     bot did:        action_search_concerts

     bot did:        action_suggest

     bot did:        action_listen

     user said:      _compare_reviews

                whose intent is:     compare_reviews

we currently have slots: <span class="o">{</span><span class="s1">&#39;location&#39;</span>: None<span class="o">}</span>

------
The bot wants to <span class="o">[</span>show_venue_reviews<span class="o">]</span> due to the intent. Is this correct?

    <span class="m">1</span>.       Yes
    <span class="m">2</span>.       No, intent is right but the action is wrong
    <span class="m">3</span>.       The intent is wrong
</pre></div>
</div>
<p>Now we type <code class="docutils literal"><span class="pre">2</span></code>, because it chose the wrong action,
and we get a new prompt asking for the correct one.
This also shows the probabilities the model has assigned to each of the actions.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>------
what is the next action <span class="k">for</span> the bot?

     <span class="m">0</span>       default  <span class="m">0</span>.00148131744936
     <span class="m">1</span>       greet    <span class="m">0</span>.0970264300704
     <span class="m">2</span>       goodbye  <span class="m">0</span>.0288009047508
     <span class="m">3</span>       listen   <span class="m">0</span>.00123148341663
     <span class="m">6</span>       search_cinemas  <span class="m">0</span>.000627864559647
     <span class="m">8</span>       search_films    <span class="m">0</span>.0367559418082
     <span class="m">9</span>       suggest         <span class="m">0</span>.0261212754995
     <span class="m">11</span>      youarewelcome   <span class="m">0</span>.594935178757
     <span class="m">13</span>      explain_options <span class="m">0</span>.0516758263111
     <span class="m">14</span>      store_slot      <span class="m">0</span>.00145904591773
     <span class="m">15</span>      show_cinema_reviews     <span class="m">0</span>.00887114647776
     <span class="m">16</span>      show_film_reviews       <span class="m">0</span>.0870243906975
</pre></div>
</div>
<p>In this case, the bot should <code class="docutils literal"><span class="pre">show_film_reviews</span></code> (rather than cinema reviews!) so we type <code class="docutils literal"><span class="pre">16</span></code> and hit enter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The policy model will get updated <em>on-the-fly</em>,
so that it&#8217;s less likely to make the same mistake again.
You can also export all of the conversations you have with the bot so you can add these as training stories in the future.</p>
</div>
<p>Now we can keep talking to the bot for as long as we like
to create a longer conversation. At any point you can type <code class="docutils literal"><span class="pre">_export</span></code>
and the bot will write the current conversation to a file,
which you can then add as a training example for the future.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_babi.html" class="btn btn-neutral float-right" title="Supervised Learning Tutorial" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tour.html" class="btn btn-neutral" title="A Quick Tour (no ML)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Rasa Technologies GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: wildcard
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../0.6.5/tutorial_scratch.html">0.6.5</a></dd>
            <dd><a href="../0.6.9/tutorial_scratch.html">0.6.9</a></dd>
            <dd><a href="../0.7.0/tutorial_scratch.html">0.7.0</a></dd>
            <dd><a href="../0.7.0a10/tutorial_scratch.html">0.7.0a10</a></dd>
            <dd><a href="../0.7.0a5/tutorial_scratch.html">0.7.0a5</a></dd>
            <dd><a href="../0.7.0a6/tutorial_scratch.html">0.7.0a6</a></dd>
            <dd><a href="../0.7.0a7/tutorial_scratch.html">0.7.0a7</a></dd>
            <dd><a href="../0.7.0a8/tutorial_scratch.html">0.7.0a8</a></dd>
            <dd><a href="../0.7.0a9/tutorial_scratch.html">0.7.0a9</a></dd>
            <dd><a href="../0.7.1/tutorial_scratch.html">0.7.1</a></dd>
            <dd><a href="../0.7.2/index.html">0.7.2</a></dd>
            <dd><a href="../0.7.3/index.html">0.7.3</a></dd>
            <dd><a href="../0.7.4/index.html">0.7.4</a></dd>
            <dd><a href="../0.7.5/index.html">0.7.5</a></dd>
            <dd><a href="../0.7.6/index.html">0.7.6</a></dd>
            <dd><a href="../0.7.7/index.html">0.7.7</a></dd>
            <dd><a href="../0.7.8/index.html">0.7.8</a></dd>
            <dd><a href="../0.7.9/index.html">0.7.9</a></dd>
            <dd><a href="../0.8.0/index.html">0.8.0</a></dd>
            <dd><a href="../0.8.1/index.html">0.8.1</a></dd>
            <dd><a href="../0.8.2/index.html">0.8.2</a></dd>
            <dd><a href="../0.8.3/index.html">0.8.3</a></dd>
            <dd><a href="../0.8.4/index.html">0.8.4</a></dd>
            <dd><a href="../0.8.5/index.html">0.8.5</a></dd>
            <dd><a href="../0.8.6/index.html">0.8.6</a></dd>
            <dd><a href="../0.9.0/index.html">0.9.0</a></dd>
            <dd><a href="../0.9.0a1/index.html">0.9.0a1</a></dd>
            <dd><a href="../0.9.0a2/index.html">0.9.0a2</a></dd>
            <dd><a href="../0.9.0a3/index.html">0.9.0a3</a></dd>
            <dd><a href="../0.9.0a5/index.html">0.9.0a5</a></dd>
            <dd><a href="../0.9.0a7/index.html">0.9.0a7</a></dd>
            <dd><a href="../0.9.1/index.html">0.9.1</a></dd>
            <dd><a href="../0.9.2/index.html">0.9.2</a></dd>
            <dd><a href="../0.9.3/index.html">0.9.3</a></dd>
            <dd><a href="../0.9.4/index.html">0.9.4</a></dd>
            <dd><a href="../0.9.5/index.html">0.9.5</a></dd>
            <dd><a href="../0.9.6/index.html">0.9.6</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../0.9.x/index.html">0.9.x</a></dd>
            <dd><a href="../add-auth/index.html">add-auth</a></dd>
            <dd><a href="../apscheduler_try/index.html">apscheduler_try</a></dd>
            <dd><a href="../async/index.html">async</a></dd>
            <dd><a href="../direct_input/index.html">direct_input</a></dd>
            <dd><a href="../dispatcher/index.html">dispatcher</a></dd>
            <dd><a href="../embed_policy/index.html">embed_policy</a></dd>
            <dd><a href="../eval_scripts/index.html">eval_scripts</a></dd>
            <dd><a href="../event-stream/index.html">event-stream</a></dd>
            <dd><a href="../fix/index.html">fix</a></dd>
            <dd><a href="../master/index.html">master</a></dd>
            <dd><a href="../model-pull/index.html">model-pull</a></dd>
            <dd><a href="../track_data/index.html">track_data</a></dd>
            <dd><a href="../train_from_url/index.html">train_from_url</a></dd>
            <dd><a href="tutorial_scratch.html">wildcard</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0a3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>