
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Development with Docker</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/banner.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Domain Format" href="../domains/" />
    <link rel="prev" title="Evaluating and Testing" href="../evaluation/" />

 <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-MMHSZCS');</script>
    <!-- End Google Tag Manager -->
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  <meta itemprop="image" content="https://rasa.com/assets/img/facebook-og.png">
  <meta property="og:title" content="Development with Docker" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rasa.com/assets/img/facebook-og.png" />
  <meta property="og:url" content="https://rasa.com/docs/core/docker_walkthrough" />
  
    <meta name="description" content="None" />
    <meta itemprop="description" content="None">
    <meta name="twitter:description" content="None" />
    <meta property="og:description" content="None" />
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Rasa_HQ">
  <meta name="twitter:title" content="Development with Docker">
  <meta name="twitter:creator" content="@Rasa_HQ">
  <meta name="twitter:image" content="https://rasa.com/assets/img/facebook-og.png">

  <link rel="stylesheet" href="../_static/xq-light.css" type="text/css" />
  <link rel="stylesheet" href="../_static/fontawesome/css/fontawesome-all.css" type="text/css" />
  <!--<script defer type="text/javascript" src="../_static/config.js"></script>
  <script defer type="text/javascript" src="../_static/klaro.js"></script>-->
  <script type="text/javascript" src="https://storage.googleapis.com/docs-theme/clipboard.min.js"></script>
  
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head><body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MMHSZCS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="nav-top">
  <div class="nav-container">
    <a href="/docs" class="brand-link">
        <h1 class="brand">
            <img src="../_static/rasa_logo.svg" width="80px" height="40px" title="Rasa logo" alt="Rasa logo">
        </h1>
        <span class="logo extension">docs</span>
    </a>

    <ul class="nav">
      <input type="text" class="search" placeholder="Search">
      
        
          <li><a href=/docs/nlu/>NLU</a></li>
        
      
        
          <li class="active"><a href=/docs/core/>Core</a></li>
        
      
        
          <li><a href=/docs/platform/>Platform</a></li>
        
      
      
      <li>
        <a href="https://github.com/rasaHQ/" target="_blank"><button class="button btn-ghost btn-small"> <i class="fab fa-github"></i>GitHub</button></a>
      </li>
      
      <li>
        <a href="https://forum.rasa.com" target="_blank"><button class="button btn-small">Ask the Community</button></a>
      </li>

    </ul>
  </div>
</div>

  <div class="sidebar-extended"></div>
  <div class="document">

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../architecture/">High-Level Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors/">Chat &amp; Voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customactions/">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slots/">Using Slots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slotfilling/">Slot Filling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../responses/">Bot Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fallbacks/">Fallback Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Training and Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evaluation/">Evaluating and Testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development with Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domain Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stories/">Story Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/slots_api/">Slot Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tracker/">Dialogue State Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/interpreter/">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/policy/">Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/featurizer/">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/dispatcher/">Dispatcher</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migrations/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tracker_stores/">Tracker Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../brokers/">Event Brokers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/">Using Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/">Getting Support</a></li>
</ul>

<div class="versions">
    <p class="caption">Versions</p>
    <div class="versions-content">
      <div>
        <span class="current-version">
          viewing: 0.12.3
        </span>
      </div>
      <div class="other-versions">
          <p>tags</p>
          <div class="dropdown-content">
              <a href=".././0.12.3/docker_walkthrough/">0.12.3</a>
              <a href=".././0.12.2/docker_walkthrough/">0.12.2</a>
              <a href=".././0.12.1/docker_walkthrough/">0.12.1</a>
              <a href=".././0.12.0/docker_walkthrough/">0.12.0</a>
              <a href=".././0.11.12/index/">0.11.12</a>
              <a href=".././0.10.4/index/">0.10.4</a>
              <a href=".././0.9.8/index/">0.9.8</a>
              <a href=".././0.8.6/index/">0.8.6</a>
              <a href=".././0.7.9/index/">0.7.9</a>
              <a href=".././0.6.9/index/">0.6.9</a>
          </div>
          <p>branches</p>
          <div class="dropdown-content">
              <a href=".././master/docker_walkthrough/">master</a>
          </div>
      </div>
    </div>
</div>


        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  





<div class="section" id="development-with-docker">
<span id="docker-walkthrough"></span><h1><a class="toc-backref" href="#id3">Development with Docker</a><a class="headerlink" href="#development-with-docker" title="Permalink to this headline">¶</a></h1>
<p>This walkthrough provides a tutorial on how to set up Rasa Core, Rasa NLU,
and an Action Server with Docker containers.
If you have not used Rasa before it is recommended to read the
<a class="reference internal" href="../quickstart/#quickstart"><span class="std std-ref">Quickstart</span></a>.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#development-with-docker" id="id3">Development with Docker</a><ul>
<li><a class="reference internal" href="#setup" id="id4">1. Setup</a></li>
<li><a class="reference internal" href="#creating-a-chatbot-using-rasa-core" id="id5">2. Creating a Chatbot Using Rasa Core</a><ul>
<li><a class="reference internal" href="#id1" id="id6">2.1 Setup</a></li>
<li><a class="reference internal" href="#training-the-rasa-core-model" id="id7">2.2 Training the Rasa Core Model</a></li>
<li><a class="reference internal" href="#testing" id="id8">2.3 Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-natural-language-understanding-rasa-nlu" id="id9">3. Adding Natural Language Understanding (Rasa NLU)</a><ul>
<li><a class="reference internal" href="#adding-nlu-training-data" id="id10">3.1 Adding NLU Training Data</a></li>
<li><a class="reference internal" href="#training-the-nlu-model" id="id11">3.1 Training the NLU Model</a></li>
<li><a class="reference internal" href="#connecting-rasa-core-and-rasa-nlu" id="id12">3.2 Connecting Rasa Core and Rasa NLU</a></li>
<li><a class="reference internal" href="#running-rasa-core-and-rasa-nlu" id="id13">3.3 Running Rasa Core and Rasa NLU</a></li>
<li><a class="reference internal" href="#adding-a-custom-nlu-pipeline" id="id14">3.4 Adding a Custom NLU Pipeline</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-custom-actions" id="id15">4. Adding Custom Actions</a><ul>
<li><a class="reference internal" href="#creating-a-custom-action" id="id16">4.1 Creating a Custom Action</a></li>
<li><a class="reference internal" href="#adding-the-action-server" id="id17">4.2 Adding the Action Server</a></li>
<li><a class="reference internal" href="#adding-custom-dependencies" id="id18">4.3 Adding Custom Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-custom-tracker-store" id="id19">5. Adding a Custom Tracker Store</a><ul>
<li><a class="reference internal" href="#using-mongodb-as-tracker-store" id="id20">5.1 Using MongoDB as Tracker Store</a></li>
<li><a class="reference internal" href="#using-redis-as-tracker-store" id="id21">5.2 Using Redis as Tracker Store</a></li>
<li><a class="reference internal" href="#using-a-custom-tracker-store-implementation" id="id22">5.3 Using a Custom Tracker Store Implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#have-questions-or-feedback" id="id23">Have questions or feedback?</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="setup">
<h2><a class="toc-backref" href="#id4">1. Setup</a><a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Requirements for the tutorial:</p>
<blockquote>
<div><ul class="simple">
<li>A text editor of your choice</li>
<li>Docker</li>
</ul>
</div></blockquote>
<p>If you are not sure whether Docker is installed on your machine execute the
following command:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker -v <span class="o">&amp;&amp;</span> docker-compose -v
<span class="c1"># Docker version 18.06.1-ce, build e68fc7a</span>
<span class="c1"># docker-compose version 1.22.0, build f46880f</span>
</pre></div>
</div>
</div></blockquote>
<p>If Docker is installed on your machine, the command above will print the
versions of docker and docker-compose. If not - please install Docker.
See <a class="reference external" href="https://docs.docker.com/install/">this instruction page</a> for the
instructions.</p>
</div>
<div class="section" id="creating-a-chatbot-using-rasa-core">
<h2><a class="toc-backref" href="#id5">2. Creating a Chatbot Using Rasa Core</a><a class="headerlink" href="#creating-a-chatbot-using-rasa-core" title="Permalink to this headline">¶</a></h2>
<p>This section will cover the following:</p>
<blockquote>
<div><ul class="simple">
<li>Setup of simple chatbot</li>
<li>Training of the Rasa Core model using Docker</li>
<li>Running the chatbot using Docker</li>
</ul>
</div></blockquote>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id6">2.1 Setup</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Start by creating a directory <code class="docutils literal notranslate"><span class="pre">data</span></code> in your project directory. Then create
a file called <code class="docutils literal notranslate"><span class="pre">stories.md</span></code> in this directory which will contain the stories
to train your chatbot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir data
touch data/stories.md
</pre></div>
</div>
<p>Then add some stories to <code class="docutils literal notranslate"><span class="pre">data/stories.md</span></code>, e.g.:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gu">##</span> happy_path
<span class="k">*</span> greet
  <span class="k">-</span> utter_greet
<span class="k">*</span> mood_happy
  <span class="k">-</span> utter_happy
<span class="k">*</span> goodbye
  <span class="k">-</span> utter_goodbye

<span class="gu">##</span> sad_path
<span class="k">*</span> greet
  <span class="k">-</span> utter_greet
<span class="k">*</span> mood_unhappy
  <span class="k">-</span> utter_cheer_up
<span class="k">*</span> goodbye
  <span class="k">-</span> utter_goodbye
</pre></div>
</div>
<p>After defining some training data for your chatbot, you have to define its domain.
To do so create a file <code class="docutils literal notranslate"><span class="pre">domain.yml</span></code> in your project directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch domain.yml
</pre></div>
</div>
<p>Then add the user intents, the actions of your chatbot, and the templates
for the chatbot responses to <code class="docutils literal notranslate"><span class="pre">domain.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">intents</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">greet</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mood_happy</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mood_unhappy</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">goodbye</span>

<span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_greet</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_happy</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_cheer_up</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_goodbye</span>

<span class="l l-Scalar l-Scalar-Plain">templates</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_greet</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">text</span><span class="p p-Indicator">:</span> <span class="s">&quot;Hi,</span><span class="nv"> </span><span class="s">how</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">going?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_happy</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">text</span><span class="p p-Indicator">:</span> <span class="s">&quot;Great,</span><span class="nv"> </span><span class="s">carry</span><span class="nv"> </span><span class="s">on!&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_cheer_up</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">text</span><span class="p p-Indicator">:</span> <span class="s">&quot;Don&#39;t</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">sad.</span><span class="nv"> </span><span class="s">Keep</span><span class="nv"> </span><span class="s">smiling!&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_goodbye</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">text</span><span class="p p-Indicator">:</span> <span class="s">&quot;Goodbye!&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="training-the-rasa-core-model">
<h3><a class="toc-backref" href="#id7">2.2 Training the Rasa Core Model</a><a class="headerlink" href="#training-the-rasa-core-model" title="Permalink to this headline">¶</a></h3>
<p>Now you can train the Rasa Core model using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/app/project <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/models/rasa_core:/app/models <span class="se">\</span>
  rasa/rasa_core:latest <span class="se">\</span>
  train <span class="se">\</span>
    --domain project/domain.yml <span class="se">\</span>
    --stories project/data/stories.md <span class="se">\</span>
    --out models
</pre></div>
</div>
<p>Command Description:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">$(pwd):/app/project</span></code>: Mounts your project directory into the Docker
container so that Rasa Core can train a model on your story data and the
domain file</li>
<li><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">$(pwd)/models/rasa_core:/app/models</span></code>: Mounts the directory
<cite>models/rasa_core</cite> in the container which is used to store the
trained Rasa Core model.</li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_core:latest</span></code>: Use the Rasa Core image with the tag <code class="docutils literal notranslate"><span class="pre">latest</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">train</span></code>: Execute the <code class="docutils literal notranslate"><span class="pre">train</span></code> command within the container with<ul>
<li><code class="docutils literal notranslate"><span class="pre">--domain</span> <span class="pre">project/domain.yml</span></code>: Path to your domain file from within the
container</li>
<li><code class="docutils literal notranslate"><span class="pre">--stories</span> <span class="pre">project/data/stories.md</span></code>: Path to your training stories from
within the container</li>
<li><code class="docutils literal notranslate"><span class="pre">--out</span> <span class="pre">models</span></code>: Instructs Rasa Core to store the trained model in the
directory <code class="docutils literal notranslate"><span class="pre">models</span></code> which corresponds to your host directory
<code class="docutils literal notranslate"><span class="pre">models/rasa_core</span></code></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>This should have created a directory called <code class="docutils literal notranslate"><span class="pre">models/rasa_core</span></code> which contains
the trained Rasa Core model.</p>
</div>
<div class="section" id="testing">
<h3><a class="toc-backref" href="#id8">2.3 Testing</a><a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>You can now test the trained model. Keep in mind
that there is currently no Rasa NLU set up. Therefore, you have to explicitly
specify the user intent using the <code class="docutils literal notranslate"><span class="pre">/</span></code> prefix, e.g. <code class="docutils literal notranslate"><span class="pre">/greet</span></code>.
Use the following command to run Rasa Core:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run <span class="se">\</span>
  -it <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/models/rasa_core:/app/models <span class="se">\</span>
  rasa/rasa_core:latest <span class="se">\</span>
  start <span class="se">\</span>
    --core models
</pre></div>
</div>
<p>Command Description:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-it</span></code>: Runs the Docker container in interactive mode so that you can
interact with the console of the container</li>
<li><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">$(pwd)/models/rasa_core:/app/models</span></code>: Mounts the trained Rasa Core
model in the container</li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_core:latest</span></code>: Use the Rasa Core image with the tag <code class="docutils literal notranslate"><span class="pre">latest</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">start</span></code>: Executes the start command which connects to the chatbot on the
command line with<ul>
<li><code class="docutils literal notranslate"><span class="pre">--core</span> <span class="pre">models</span></code>: Defines the location of the trained model which is
used for the conversation.</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="adding-natural-language-understanding-rasa-nlu">
<h2><a class="toc-backref" href="#id9">3. Adding Natural Language Understanding (Rasa NLU)</a><a class="headerlink" href="#adding-natural-language-understanding-rasa-nlu" title="Permalink to this headline">¶</a></h2>
<p>This section will cover the following:</p>
<blockquote>
<div><ul class="simple">
<li>Creation of Rasa NLU training data</li>
<li>Training of the Rasa NLU model using Docker</li>
<li>Connecting Rasa Core and Rasa NLU</li>
<li>Adding a custom NLU pipeline</li>
</ul>
</div></blockquote>
<div class="section" id="adding-nlu-training-data">
<h3><a class="toc-backref" href="#id10">3.1 Adding NLU Training Data</a><a class="headerlink" href="#adding-nlu-training-data" title="Permalink to this headline">¶</a></h3>
<p>To add some Rasa NLU training data, add a file <code class="docutils literal notranslate"><span class="pre">nlu.md</span></code> to your <code class="docutils literal notranslate"><span class="pre">data</span></code>
directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch data/nlu.md
</pre></div>
</div>
<p>Then add some examples to each intent, e.g.:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gu">##</span> intent:greet
<span class="k">-</span> hey
<span class="k">-</span> hello
<span class="k">-</span> hi
<span class="k">-</span> good morning
<span class="k">-</span> good evening
<span class="k">-</span> hey there

<span class="gu">##</span> intent:mood_happy
<span class="k">-</span> perfect
<span class="k">-</span> very good
<span class="k">-</span> great
<span class="k">-</span> amazing
<span class="k">-</span> wonderful
<span class="k">-</span> I am feeling very good
<span class="k">-</span> I am great
<span class="k">-</span> I&#39;m good

<span class="gu">##</span> intent:mood_unhappy
<span class="k">-</span> sad
<span class="k">-</span> very sad
<span class="k">-</span> unhappy
<span class="k">-</span> bad
<span class="k">-</span> very bad
<span class="k">-</span> awful
<span class="k">-</span> terrible
<span class="k">-</span> not very good
<span class="k">-</span> extremely sad
<span class="k">-</span> so sad

<span class="gu">##</span> intent:goodbye
<span class="k">-</span> bye
<span class="k">-</span> goodbye
<span class="k">-</span> see you around
<span class="k">-</span> see you later
</pre></div>
</div>
</div>
<div class="section" id="training-the-nlu-model">
<h3><a class="toc-backref" href="#id11">3.1 Training the NLU Model</a><a class="headerlink" href="#training-the-nlu-model" title="Permalink to this headline">¶</a></h3>
<p>You can then train the Rasa NLU model by executing the command below.
As output of the command the directory <code class="docutils literal notranslate"><span class="pre">models/rasa_nlu</span></code> will contain
the trained Rasa NLU model:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/app/project <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/models/rasa_nlu:/app/models <span class="se">\</span>
  rasa/rasa_nlu:latest-spacy <span class="se">\</span>
  run <span class="se">\</span>
    python -m rasa_nlu.train <span class="se">\</span>
    -c config.yml <span class="se">\</span>
    -d project/data/nlu.md <span class="se">\</span>
    -o models <span class="se">\</span>
    --project current
</pre></div>
</div>
<p>Command Description:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">$(pwd):/app/project</span></code>: Mounts your project directory into the Docker
container so that the chatbot can be trained on your NLU data.</li>
<li><code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">$(pwd)/models/rasa_nlu:/app/models</span></code>: Mounts the directory
<code class="docutils literal notranslate"><span class="pre">models/rasa_nlu</span></code> in the container which is used to store the
trained Rasa NLU model.</li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_nlu:latest-spacy</span></code>: Using the latest Rasa NLU which uses
the <cite>spaCy</cite> <a class="reference external" href="https://rasa.com/docs/nlu/choosing_pipeline/">pipeline</a> .</li>
<li><code class="docutils literal notranslate"><span class="pre">run</span></code>: Entrypoint parameter to run any command within the NLU container</li>
<li><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">rasa_nlu.train</span></code>: Starts the NLU training with<ul>
<li><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">config.yml</span></code>: Uses the default NLU pipeline configuration which is
provided by the Docker image</li>
<li><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">project/data/nlu.md</span></code>: Path to the NLU training data</li>
<li><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">models</span></code>: The directory which is used to store the NLU models</li>
<li><code class="docutils literal notranslate"><span class="pre">--project</span> <span class="pre">current</span></code>: The project name to use.</li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="connecting-rasa-core-and-rasa-nlu">
<h3><a class="toc-backref" href="#id12">3.2 Connecting Rasa Core and Rasa NLU</a><a class="headerlink" href="#connecting-rasa-core-and-rasa-nlu" title="Permalink to this headline">¶</a></h3>
<p>You can connect Rasa Core and Rasa NLU by running each container
individually. However, this setup can get quite complicated
as soon as more components are added. Therefore, it is suggested to use
<a class="reference external" href="https://docs.docker.com/compose/">docker compose</a> which uses a so called
<cite>compose file</cite> to specify all components and their configuration. This makes it
possible to start all components using a single command.</p>
<p>Start with creating the compose file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch docker-compose.yml
</pre></div>
</div>
<p>The file starts with the version of the Docker Compose specification that you
want to use, e.g.:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="s">&#39;3.0&#39;</span>
</pre></div>
</div>
<p>Each container is declared as a <code class="docutils literal notranslate"><span class="pre">service</span></code> within the docker compose file.
The first service is the <code class="docutils literal notranslate"><span class="pre">rasa_core</span></code> service.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rasa_core</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa/rasa_core:latest</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5005:5005</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./models/rasa_core:/app/models</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--core</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">models</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rest</span>
</pre></div>
</div>
<p>The command is similar to the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command in section 2.4.
Note the use of the port mapping and the additional parameters <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">rest</span></code>.
The <code class="docutils literal notranslate"><span class="pre">ports</span></code> part defines a port mapping between the container and your host
system. In this case it makes <code class="docutils literal notranslate"><span class="pre">5005</span></code> of the <code class="docutils literal notranslate"><span class="pre">rasa_core</span></code> service available on
port <code class="docutils literal notranslate"><span class="pre">5005</span></code> of your host.
This is the port of the <a class="reference internal" href="../connectors/#rest-channels"><span class="std std-ref">REST Channels</span></a> interface of Rasa Core.</p>
<p>The parameters <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">rest</span></code> instruct Rasa Core to use REST as input / output
channel. Since Docker Compose starts a set of Docker containers it is not longer
possible to directly connect to one single container after executing the
<code class="docutils literal notranslate"><span class="pre">run</span></code> command.</p>
<p>Then add the Rasa NLU service to your docker compose file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">rasa_nlu</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa/rasa_nlu:latest-spacy</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./models/rasa_nlu:/app/models</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--path</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">models</span>
</pre></div>
</div>
<p>This maps the Rasa NLU model in the container and instructs Rasa NLU to run
the server for the model.</p>
<p>To instruct Rasa Core to connect to the Rasa NLU server and which NLU model
it should use, it is required to create a file <code class="docutils literal notranslate"><span class="pre">config/endpoints.yml</span></code> which
contains the URL Rasa Core should connect to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir config
touch config/endpoints.yml
</pre></div>
</div>
<p>Docker containers which are started using Docker Compose are using the same
network. Hence, each service can access other services by their service name.
Therefore, you can use <code class="docutils literal notranslate"><span class="pre">rasa_nlu</span></code> as host in <code class="docutils literal notranslate"><span class="pre">config/endpoints.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nlu</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://rasa_nlu:5000</span>
</pre></div>
</div>
<p>To make the endpoint configuration available to Rasa Core, you need to mount
the <code class="docutils literal notranslate"><span class="pre">config</span></code> directory into the Rasa Core container.
Then instruct Rasa Core to use the endpoints configuration with the parameter
<code class="docutils literal notranslate"><span class="pre">--endpoints</span> <span class="pre">&lt;path</span> <span class="pre">to</span> <span class="pre">endpoints.yml&gt;</span></code> and define the targeted Rasa NLU model
with <code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">&lt;nlu</span> <span class="pre">model</span> <span class="pre">to</span> <span class="pre">use&gt;</span></code>. By adding this additional configuration to
your <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> it should have the following content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="s">&#39;3.0&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rasa_core</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa/rasa_core:latest</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5005:5005</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./models/rasa_core:/app/models</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./config:/app/config</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--core</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">models</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rest</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--endpoints</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">config/endpoints.yml</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-u</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">current/</span>
  <span class="l l-Scalar l-Scalar-Plain">rasa_nlu</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa/rasa_nlu:latest-spacy</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./models/rasa_nlu:/app/models</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--path</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">models</span>
</pre></div>
</div>
</div>
<div class="section" id="running-rasa-core-and-rasa-nlu">
<h3><a class="toc-backref" href="#id13">3.3 Running Rasa Core and Rasa NLU</a><a class="headerlink" href="#running-rasa-core-and-rasa-nlu" title="Permalink to this headline">¶</a></h3>
<p>To start Rasa Core and Rasa NLU execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose up
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Add the flag <code class="docutils literal notranslate"><span class="pre">-d</span></code> if you want to run it detached.</p>
</div>
<p>The REST API of Rasa Core is then available on <code class="docutils literal notranslate"><span class="pre">http://localhost:5005</span></code>.
To send messages to your chatbot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl --request POST <span class="se">\</span>
  --url http://localhost:5005/webhooks/rest/webhook <span class="se">\</span>
  --header <span class="s1">&#39;content-type: application/json&#39;</span> <span class="se">\</span>
  --data <span class="s1">&#39;{</span>
<span class="s1">    &quot;message&quot;: &quot;hello&quot;</span>
<span class="s1">  }&#39;</span>
</pre></div>
</div>
<p>Your chatbot should then answer something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">&quot;recipient_id&quot;</span>: <span class="s2">&quot;default&quot;</span>,
    <span class="s2">&quot;text&quot;</span>: <span class="s2">&quot;Hi, how is it going?&quot;</span>
  <span class="o">}</span>
<span class="o">]</span>
</pre></div>
</div>
<p>If the chatbot cannot understand you, the answer is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p>
</div>
<div class="section" id="adding-a-custom-nlu-pipeline">
<h3><a class="toc-backref" href="#id14">3.4 Adding a Custom NLU Pipeline</a><a class="headerlink" href="#adding-a-custom-nlu-pipeline" title="Permalink to this headline">¶</a></h3>
<p>If you want to configure the components of your
<a class="reference external" href="https://rasa.com/docs/nlu/choosing_pipeline/">NLU Pipeline</a>, start by
creating a file <code class="docutils literal notranslate"><span class="pre">nlu_config.yml</span></code> in your <code class="docutils literal notranslate"><span class="pre">config</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch config/nlu_config.yml
</pre></div>
</div>
<p>Put the description of your custom pipeline in there, e.g.:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">pipeline</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;nlp_spacy&quot;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;tokenizer_spacy&quot;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;intent_entity_featurizer_regex&quot;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;intent_featurizer_spacy&quot;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;ner_crf&quot;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;intent_classifier_sklearn&quot;</span>
</pre></div>
</div>
<p>Then retrain your NLU model. In contrast to the previous training also mount
the <code class="docutils literal notranslate"><span class="pre">config</span></code> directory which contains the NLU configuration
and specify it in the run command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/app/project <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/models/rasa_nlu:/app/models <span class="se">\</span>
  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/config:/app/config <span class="se">\</span>
  rasa/rasa_nlu:latest-spacy <span class="se">\</span>
  run <span class="se">\</span>
    python -m rasa_nlu.train <span class="se">\</span>
    -c config/nlu_config.yml <span class="se">\</span>
    -d project/data/nlu.md <span class="se">\</span>
    -o models <span class="se">\</span>
    --project current
</pre></div>
</div>
<p>Then adapt the NLU start command in your docker compose so that it uses your
NLU configuration. As in for the training mount the <code class="docutils literal notranslate"><span class="pre">config</span></code> directory into
your NLU container and instruct Rasa NLU to use this configuration by adding
the flag <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;path</span> <span class="pre">to</span> <span class="pre">your</span> <span class="pre">nlu</span> <span class="pre">config&gt;</span></code>.
The configuration of the <code class="docutils literal notranslate"><span class="pre">rasa_nlu</span></code> server might then look similar to this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">rasa_nlu</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa/rasa_nlu:latest-spacy</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./models/rasa_nlu:/app/models</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./config:/app/config</span>
    <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">start</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--path</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">models</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-c</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">config/nlu_config.yml</span>
</pre></div>
</div>
<p>Depending on the selected
<a class="reference external" href="https://rasa.com/docs/nlu/choosing_pipeline/">NLU Pipeline</a> you might
have to use a different Rasa NLU image:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_nlu:latest-spacy</span></code>: To use the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> pipeline</li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_nlu:latest-tensorflow</span></code>: To use the <code class="docutils literal notranslate"><span class="pre">tensorflow_embedding</span></code>
pipeline</li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_nlu:latest-mitie</span></code>: To use a pipeline which includes <code class="docutils literal notranslate"><span class="pre">mitie</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_nlu:latest-full</span></code>: To build a pipeline with dependencies to
spaCy and TensorFlow</li>
<li><code class="docutils literal notranslate"><span class="pre">rasa/rasa_nlu:latest-bare</span></code>: To start with minimal dependencies so
that you can then add your own</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="adding-custom-actions">
<h2><a class="toc-backref" href="#id15">4. Adding Custom Actions</a><a class="headerlink" href="#adding-custom-actions" title="Permalink to this headline">¶</a></h2>
<p>To create more sophisticated chatbots you will probably use <a class="reference internal" href="../customactions/#customactions"><span class="std std-ref">Actions</span></a>.
Continuing the example from above you might want to add an action which tells
the user a joke to cheer the user up.</p>
<div class="section" id="creating-a-custom-action">
<h3><a class="toc-backref" href="#id16">4.1 Creating a Custom Action</a><a class="headerlink" href="#creating-a-custom-action" title="Permalink to this headline">¶</a></h3>
<p>Start with creating the custom actions in a directory <code class="docutils literal notranslate"><span class="pre">actions</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir actions
<span class="c1"># Rasa Core SDK expects a python module.</span>
<span class="c1"># Therefore, make sure that you have this file in the direcotry.</span>
touch __init__.py
touch actions/actions.py
</pre></div>
</div>
<p>Then build a custom action using the Rasa Core SDK, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">rasa_core_sdk</span> <span class="kn">import</span> <span class="n">Action</span>


<span class="k">class</span> <span class="nc">ActionJoke</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;action_joke&quot;</span>

  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://api.icndb.com/jokes/random&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1">#make an api call</span>
    <span class="n">joke</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="s1">&#39;joke&#39;</span><span class="p">]</span> <span class="c1">#extract a joke from returned json response</span>
    <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="n">joke</span><span class="p">)</span> <span class="c1">#send the message back to the user</span>
    <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Next add the custom action in your stories and your domain file.
Continuing the example from above replace <code class="docutils literal notranslate"><span class="pre">utter_cheer_up</span></code> in
<code class="docutils literal notranslate"><span class="pre">data/stories.md</span></code> with the custom action <code class="docutils literal notranslate"><span class="pre">action_joke</span></code> and add
<code class="docutils literal notranslate"><span class="pre">action_joke</span></code> to the actions in the domain file.</p>
</div>
<div class="section" id="adding-the-action-server">
<h3><a class="toc-backref" href="#id17">4.2 Adding the Action Server</a><a class="headerlink" href="#adding-the-action-server" title="Permalink to this headline">¶</a></h3>
<p>The custom actions are run by the action server.
To spin it up together with Rasa Core and Rasa NLU, add a service
<code class="docutils literal notranslate"><span class="pre">action_server</span></code> to the <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">action_server</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa/rasa_core_sdk:latest</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./actions:/app/actions</span>
</pre></div>
</div>
<p>This pulls the image for the Rasa Core SDK which includes the action server,
mounts your custom actions into it, and starts the server.</p>
<p>As for Rasa NLU, it is necessary to tell Rasa Core the location of the action
server. Add this to your <code class="docutils literal notranslate"><span class="pre">config/endpoints.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">action_endpoint</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://action_server:5055/webhook</span>
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code> to start the action server together
with Rasa Core and Rasa NLU and to execute your custom actions.</p>
</div>
<div class="section" id="adding-custom-dependencies">
<h3><a class="toc-backref" href="#id18">4.3 Adding Custom Dependencies</a><a class="headerlink" href="#adding-custom-dependencies" title="Permalink to this headline">¶</a></h3>
<p>If your action has additional dependencies, either systems or python libraries,
you can add these by extending the official image.</p>
<p>To do so create a Dockerfile, extend the official image and add your custom
dependencies, e.g.:</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="c"># Extend the offical Rasa Core SDK image</span>
<span class="k">FROM</span><span class="s"> rasa/rasa_core_sdk:latest</span>

<span class="c"># Add a custom system library (e.g. git)</span>
<span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apt-get install -y git

<span class="c"># Add a custom python library (e.g. jupyter)</span>
<span class="k">RUN</span> pip install --no-cache-dir <span class="se">\</span>
    jupyter
</pre></div>
</div>
<p>You can then build the image and use it in your <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build . -t &lt;name of your custom image&gt;:&lt;tag of your custom image&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-a-custom-tracker-store">
<h2><a class="toc-backref" href="#id19">5. Adding a Custom Tracker Store</a><a class="headerlink" href="#adding-a-custom-tracker-store" title="Permalink to this headline">¶</a></h2>
<p>By default all conversations are saved in-memory. This mean that all
conversations are lost as soon as you restart Rasa Core.
If you want to persist your conversations, you can use different
<a class="reference internal" href="../tracker_stores/#tracker-store"><span class="std std-ref">Tracker Stores</span></a>.</p>
<div class="section" id="using-mongodb-as-tracker-store">
<h3><a class="toc-backref" href="#id20">5.1 Using MongoDB as Tracker Store</a><a class="headerlink" href="#using-mongodb-as-tracker-store" title="Permalink to this headline">¶</a></h3>
<p>Start by adding MongoDB to your docker-compose file. The following example
adds the MongoDB as well as a UI (you can skip this), which will be available
at <code class="docutils literal notranslate"><span class="pre">localhost:8081</span></code>. Username and password for the MongoDB instance are
specified as <code class="docutils literal notranslate"><span class="pre">rasa</span></code> and <code class="docutils literal notranslate"><span class="pre">example</span></code>. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mongo</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
  <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa</span>
    <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="l l-Scalar l-Scalar-Plain">mongo-express</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo-express</span>
  <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">8081:8081</span>
  <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">ME_CONFIG_MONGODB_ADMINUSERNAME</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa</span>
    <span class="l l-Scalar l-Scalar-Plain">ME_CONFIG_MONGODB_ADMINPASSWORD</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>
</pre></div>
</div>
<p>Then add the MongoDB to the <code class="docutils literal notranslate"><span class="pre">tracker_store</span></code> section of your endpoints
configuration <code class="docutils literal notranslate"><span class="pre">config/endpoints.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tracker_store</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">store_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongod</span>
  <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb://mongo:27017</span>
  <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rasa</span>
  <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>
</pre></div>
</div>
<p>Then start all components with <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code>.</p>
</div>
<div class="section" id="using-redis-as-tracker-store">
<h3><a class="toc-backref" href="#id21">5.2 Using Redis as Tracker Store</a><a class="headerlink" href="#using-redis-as-tracker-store" title="Permalink to this headline">¶</a></h3>
<p>Start by adding Redis to your docker-compose file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">redis</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">redis:latest</span>
</pre></div>
</div>
<p>Then add Redis to the <code class="docutils literal notranslate"><span class="pre">tracker_store</span></code> section of your endpoint
configuration <code class="docutils literal notranslate"><span class="pre">config/endpoints.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tracker_store</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">store_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">redis</span>
  <span class="l l-Scalar l-Scalar-Plain">url</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">redis</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-custom-tracker-store-implementation">
<h3><a class="toc-backref" href="#id22">5.3 Using a Custom Tracker Store Implementation</a><a class="headerlink" href="#using-a-custom-tracker-store-implementation" title="Permalink to this headline">¶</a></h3>
<p>If you have a custom implementation of a tracker store you have two options
to add this store to Rasa Core:</p>
<blockquote>
<div><ul class="simple">
<li>extending the Rasa Core image</li>
<li>mounting it as volume</li>
</ul>
</div></blockquote>
<p>Then add the required configuration to your endpoint configuration
<code class="docutils literal notranslate"><span class="pre">config/endpoints.yml</span></code> as it is described in <a class="reference internal" href="../tracker_stores/#tracker-store"><span class="std std-ref">Tracker Stores</span></a>.
If you want the tracker store component (e.g. a certain database) to be part
of your docker compose file, add a corresponding service and configuration
there.</p>
</div>
</div>
<div class="section" id="have-questions-or-feedback">
<h2><a class="toc-backref" href="#id23">Have questions or feedback?</a><a class="headerlink" href="#have-questions-or-feedback" title="Permalink to this headline">¶</a></h2>
<p>We have a very active support community on <a class="reference external" href="https://forum.rasa.com">Rasa Community Forum</a>
that is happy to help you with your questions. If you have any feedback for us or a specific
suggestion for improving the docs, feel free to share it by creating an issue on Rasa Core
<a class="reference external" href="https://github.com/RasaHQ/rasa_core/issues">GitHub repository</a>.</p>
</div>
</div>


	    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
	    <script type="text/javascript"> docsearch({
	     apiKey: '1f9e0efb89e98543f6613a60f847b176',
	     indexName: 'rasa',
	     inputSelector: 'body > div.nav-top > .nav-container > .nav > input',
	     debug: false // Set debug to true if you want to inspect the dropdown
	    });
	    </script>
          </div>

          <div class="footer">

            <div class="social">
              <a href="https://github.com/RasaHQ" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
              <a href="https://stackoverflow.com/search?q=rasa" target="_blank" title="Stack Overflow"><i class="fab fa-stack-overflow"></i></a>
              <a href="https://www.youtube.com/channel/UCJ0V6493mLvqdiVwOKWBODQ" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
              <a href="https://twitter.com/rasa_hq" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
            </div>

            <div class="copyright small">
            &copy;2018, Rasa Technologies GmbH | <a href="https://rasa.com/imprint/" target="_blank">Imprint</a> | <a href="https://rasa.com/privacy-policy/" target="_blank">Privacy Policy</a>
            
            </div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>

    

  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag(...arguments) {
      dataLayer.push(...arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-87333416-1', {
      'anonymize_ip': true,
    });
  </script>
  <script src="https://rasa.com/assets/js/js.cookies.js"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- TODO: Re-Enable once Klaro is re-activated again. Remove the next two lines, then.
  <script type="opt-in" data-name="googleanalytics" data-type="text/javascript" data-src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script type="opt-in" data-name="googleanalytics" data-type="text/javascript" data-src="https://rasa.com/assets/js/userId.js"></script>
  -->
  <script src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script src="https://rasa.com/assets/js/userId.js"></script>
  <script type="text/javascript">
    var clipboard = new ClipboardJS('.copyable');
    clipboard.on('success', function(e) {
      gtag('event', e.action, {
        'event_category': 'code',
        'event_label': e.text
      });
      const id = e.text.slice(0,3);
      document.getElementById(id).classList.add('visible');
      setTimeout(function(){
        document.getElementById(id).classList.remove('visible');},
        800
      );
    });
    clipboard.on('error', function(e) {
      console.log(e);
    });
  </script>

  <!-- onsite anchor fix (otherwise anchors scroll to far) -->
  <script>
    /* Adapted from https://stackoverflow.com/a/13067009/1906073 */
    (function(document, history, location) {
      var HISTORY_SUPPORT = !!(history && history.pushState);

      var anchorScrolls = {
        ANCHOR_REGEX: /^#[^ ]+$/,
        OFFSET_HEIGHT_PX: 66,

        /**
         * Establish events, and fix initial scroll position if a hash is provided.
         */
        init: function() {
          this.scrollToCurrent();
          $(window).on('hashchange', $.proxy(this, 'scrollToCurrent'));
          $('body').on('click', 'a', $.proxy(this, 'delegateAnchors'));
        },

        /**
         * Return the offset amount to deduct from the normal scroll position.
         * Modify as appropriate to allow for dynamic calculations
         */
        getFixedOffset: function() {
          return this.OFFSET_HEIGHT_PX;
        },

        /**
         * If the provided href is an anchor which resolves to an element on the
         * page, scroll to it.
         * @param  {String} href
         * @return {Boolean} - Was the href an anchor.
         */
        scrollIfAnchor: function(href, pushToHistory) {
          var match, anchorOffset;

          if(!this.ANCHOR_REGEX.test(href)) {
            return false;
          }

          match = document.getElementById(href.slice(1));

          if(match) {
            anchorOffset = $(match).offset().top - this.getFixedOffset();
            $('html, body').animate({ scrollTop: anchorOffset});

            // Add the state to history as-per normal anchor links
            if(HISTORY_SUPPORT && pushToHistory) {
              history.pushState({}, document.title, location.pathname + href);
            }
          }

          return !!match;
        },

        /**
         * Attempt to scroll to the current location's hash.
         */
        scrollToCurrent: function(e) {
          if(this.scrollIfAnchor(window.location.hash) && e) {
            e.preventDefault();
          }
        },

        /**
         * If the click event's target was an anchor, fix the scroll position.
         */
        delegateAnchors: function(e) {
          var elem = e.target;

          if(this.scrollIfAnchor(elem.getAttribute('href'), true)) {
            e.preventDefault();
          }
        }
      };

      $(document).ready($.proxy(anchorScrolls, 'init'));
    })(window.document, window.history, window.location);

  </script>
  <div id="webchat">
  <script src="https://storage.googleapis.com/mrbot-cdn/webchat-0.4.2.js"></script>
  <script>
   WebChat.default.init({
       selector: "#webchat",
       initPayload: "/greet",
       interval: 500,
       socketUrl: "https://website-demo.rasa.com/",
       title: "Sara",
       subtitle: "I'm still in development",
       profileAvatar: "https://rasa.com/assets/img/demo/sara_avatar.png",
       showCloseButton: true,
       fullScreenMode: false,})
  </script>
  </div>
  </body>
</html>