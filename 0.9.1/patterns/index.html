

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Slot Filling and Common Patterns &mdash; Rasa Core 0.9.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex/"/>
        <link rel="search" title="Search" href="../search/"/>
    <link rel="top" title="Rasa Core 0.9.1 documentation" href="../"/>
        <link rel="next" title="Plumbing - How it all fits together" href="../plumbing/"/>
        <link rel="prev" title="Stories - The Training Data" href="../stories/"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../" class="icon icon-home"> Rasa Core
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../motivation/">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../no_python/">But I don’t code in python!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_basics/">Building a Simple Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_supervised/">Supervised Learning Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_interactive_learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_remote/">Rasa Core without Python</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Dives</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domain, Slots, and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stories/">Stories - The Training Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Slot Filling and Common Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#collecting-information-to-complete-a-request-slot-filling">Collecting Information to Complete a Request (Slot Filling)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#validation-and-free-text-input">Validation and Free-text Input</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#collecting-information-using-slots">Collecting Information using Slots</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-slot-values-to-influence-which-actions-are-predicted">Using Slot Values to Influence Which Actions are Predicted</a></li>
<li class="toctree-l2"><a class="reference internal" href="#storing-api-responses-in-the-tracker">Storing API responses in the tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fallback-default-actions">Fallback / Default Actions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plumbing/">Plumbing - How it all fits together</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http/">HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors/">Connecting to messaging &amp; voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors/#using-ngrok-for-local-testing">Using Ngrok For Local Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduling/">Scheduling Reminders</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tracker/">Dialogue State Tracker</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../featurisation/">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interpreters/">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../state/">Tracking Conversation State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Rasa Core</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../">Docs</a> &raquo;</li>
        
      <li>Slot Filling and Common Patterns</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/patterns.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../0.9.6/patterns.html"><b>Warning:</b> This document is for an old version of Rasa Core. The latest version is 0.9.6.</a></p>

<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="slot-filling-and-common-patterns">
<span id="patterns"></span><h1>Slot Filling and Common Patterns<a class="headerlink" href="#slot-filling-and-common-patterns" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here we go through some typical conversation patterns and explain how to implement
them with Rasa Core.</p>
</div>
<p>Rasa Core uses ML models to predict actions, and <code class="docutils literal notranslate"><span class="pre">slots</span></code> provide important
information these models rely on to keep track of context and handle multi-turn dialogue.
Slots are for storing information that’s relevant over multiple turns. For example, in
our restaurant example, we would want to keep track of things like the cuisine and number of
people for the duration of the conversation.</p>
<div class="section" id="collecting-information-to-complete-a-request-slot-filling">
<h2>Collecting Information to Complete a Request (Slot Filling)<a class="headerlink" href="#collecting-information-to-complete-a-request-slot-filling" title="Permalink to this headline">¶</a></h2>
<p>Probably the most common pattern of all is to collect a few pieces of information
from a user in order to do something (book a restaurant, call an API, search a database, etc.).
This is also called slot filling.</p>
<p>To make this easier, Rasa has a special action class called <code class="docutils literal notranslate"><span class="pre">FormAction</span></code>.
This lets you have a single action for this task, rather than separate actions for each question,
e.g. <code class="docutils literal notranslate"><span class="pre">utter_ask_cuisine</span></code>, <code class="docutils literal notranslate"><span class="pre">utter_ask_numpeople</span></code>, etc.</p>
<p>You don’t <em>have</em> to use <code class="docutils literal notranslate"><span class="pre">FormAction</span></code> s to do slot filling, but it can be easier.</p>
<p>A form action has a set of required fields, which you define for the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActionSearchRestaurants</span><span class="p">(</span><span class="n">FormAction</span><span class="p">):</span>

    <span class="n">RANDOMIZE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">required_fields</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">EntityFormField</span><span class="p">(</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;cuisine&quot;</span><span class="p">),</span>
            <span class="n">EntityFormField</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;people&quot;</span><span class="p">),</span>
            <span class="n">BooleanFormField</span><span class="p">(</span><span class="s2">&quot;vegetarian&quot;</span><span class="p">,</span> <span class="s2">&quot;affirm&quot;</span><span class="p">,</span> <span class="s2">&quot;deny&quot;</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;action_search_restaurants&#39;</span>

    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">RestaurantAPI</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;cuisine&quot;</span><span class="p">),</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;people&quot;</span><span class="p">),</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;vegetarian&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;search_results&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)]</span>
</pre></div>
</div>
<p>The way this works is that every time you call this action, it will pick one of the
<code class="docutils literal notranslate"><span class="pre">REQUIRED_FIELDS</span></code> that’s still missing and ask the user for it. You can also ask a yes/no
question with a <code class="docutils literal notranslate"><span class="pre">BooleanFormField</span></code>.</p>
<p>The story will look something like this:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="k">*</span> request_restaurant
     <span class="k">-</span> action_restaurant_form
     <span class="k">-</span> slot{&quot;requested_slot&quot;: &quot;people&quot;}
<span class="k">*</span> inform{&quot;number&quot;: 3}
     <span class="k">-</span> action_restaurant_form
     <span class="k">-</span> slot{&quot;people&quot;: 3}
     <span class="k">-</span> slot{&quot;requested_slot&quot;: &quot;time&quot;}
<span class="k">*</span> inform{&quot;time&quot;: &quot;8pm&quot;}
   <span class="k">-</span> action_restaurant_form
</pre></div>
</div>
<p>Some important things to consider:</p>
<ul class="simple">
<li>Your domain needs to have a slot called <code class="docutils literal notranslate"><span class="pre">requested_slot</span></code>. This can be unfeaturized, but if you want
to support contextual questions like <em>“why do you need to know that information?”</em> it will help if you make this
a categorical slot.</li>
<li>You need to define utterances for asking for each slot in your domain, e.g. <code class="docutils literal notranslate"><span class="pre">utter_ask_{slot_name}</span></code>.</li>
<li>We strongly recommend that you create these stories using interactive learning, because if you
type these by hand you will probably forget to add all of the slots.</li>
<li>Any slots that are already set won’t be asked for. E.g. if someone says “I’d like a Chinese restaurant for 8 people” the <code class="docutils literal notranslate"><span class="pre">submit</span></code> function should get called right away.</li>
</ul>
<div class="section" id="validation-and-free-text-input">
<h3>Validation and Free-text Input<a class="headerlink" href="#validation-and-free-text-input" title="Permalink to this headline">¶</a></h3>
<p>For any subclass of  <code class="docutils literal notranslate"><span class="pre">FormField</span></code>, it’s <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method will be called before setting it
as a slot. By default this just checks that the value isn’t <code class="docutils literal notranslate"><span class="pre">None</span></code>, but if you want to check
the value against a DB, or check a pattern is matched, you can do so by defining your own class
like <code class="docutils literal notranslate"><span class="pre">MyCustomFormField</span></code> and overriding the <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method.</p>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">FreeTextFormField</span></code> class which will just extract the user message as a value.
However, there is no way to write a ‘wildcard’ intent in Rasa Core stories as of now. Typically
your NLU model will assign this free-text input to 2-3 different intents.
It’s easiest to add stories for each of these.</p>
</div>
</div>
<div class="section" id="collecting-information-using-slots">
<h2>Collecting Information using Slots<a class="headerlink" href="#collecting-information-using-slots" title="Permalink to this headline">¶</a></h2>
<p>For collecting a set of preferences, you can use <code class="docutils literal notranslate"><span class="pre">TextSlot</span></code> s like in the restaurant example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">slots</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">cuisine</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
<span class=" -Error"> </span><span class="l l-Scalar l-Scalar-Plain">people</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
 <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>When Rasa sees an entity with the same name as one of the slots, this value is automatically saved.
For example, if your NLU module detects the entity <code class="docutils literal notranslate"><span class="pre">people=8</span></code> in the sentence <em>“I’d like a table for 8”</em>,
this will be saved as a slot,</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">slots</span>
<span class="go">{&#39;people&#39;: &lt;TextSlot(people: 8)&gt;}</span>
</pre></div>
</div>
<p>When Rasa Core predicts the next action to take, the only information it has about the <code class="docutils literal notranslate"><span class="pre">TextSlot</span></code> s is
<strong>whether or not they are defined</strong>. So you have enough information to know that you don’t have to ask for this
information again, but the <em>value</em> of a <code class="docutils literal notranslate"><span class="pre">TextSlot</span></code> has no impact on which actions Rasa Core predicts. This is
explained in <a class="reference internal" href="#slot-features"><span class="std std-ref">more detail below</span></a>.</p>
<p>The full set of slot types and their behaviour is described here: <a class="reference internal" href="../domains/#slot-types"><span class="std std-ref">Slots</span></a>.</p>
</div>
<div class="section" id="using-slot-values-to-influence-which-actions-are-predicted">
<h2>Using Slot Values to Influence Which Actions are Predicted<a class="headerlink" href="#using-slot-values-to-influence-which-actions-are-predicted" title="Permalink to this headline">¶</a></h2>
<p><strong>Custom Slots</strong></p>
<p>Maybe your restaurant booking system can only handle bookings for up to 6 people, so the
request above isn’t valid. In this case you want the <em>value</em> of the slot to influence the
next selected action (not just whether it’s been specified). You can achieve this using a custom
slot class.</p>
<p>The way we defined it below, if the number of people is less than or equal to 6, we return <code class="docutils literal notranslate"><span class="pre">(1,0)</span></code>,
if it’s more we return <code class="docutils literal notranslate"><span class="pre">(0,1)</span></code>, and if it’s not set <code class="docutils literal notranslate"><span class="pre">(0,0)</span></code>.</p>
<p>Rasa Core can use that information to distinguish between different situations - so long as
you have some training stories where the appropriate responses take place, e.g.:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh">#</span> story1
...
<span class="k">*</span> inform{&quot;people&quot;: &quot;3&quot;}
<span class="k">-</span> action_book_table
...
<span class="gh">#</span> story2
<span class="k">*</span> inform{&quot;people&quot;: &quot;9&quot;}
<span class="k">-</span> action_explain_table_limit
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go">from rasa_core.slots import Slot</span>

<span class="go">class NumberOfPeopleSlot(Slot):</span>

<span class="go">  def feature_dimensionality(self):</span>
<span class="go">      return 2</span>

<span class="go">  def as_feature(self):</span>
<span class="go">      r = [0.0] * self.feature_dimensionality()</span>
<span class="go">      if self.value:</span>
<span class="go">          if self.value &lt;= 6:</span>
<span class="go">              r[0] = 1.0</span>
<span class="go">          else:</span>
<span class="go">              r[1] = 1.0</span>
<span class="go">      return r</span>
</pre></div>
</div>
<p>If you want to store something like the price range, this is actually a little simpler. Variables
like price range usually take on one-of-n values, e.g. low, medium, high. For these cases you can use
a <code class="docutils literal notranslate"><span class="pre">categorical</span></code> slot.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">slots</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">price_range</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">categorical</span>
    <span class="l l-Scalar l-Scalar-Plain">values</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">low, medium, high</span>
</pre></div>
</div>
<p>Rasa automatically represents (featurises) this as a one-hot encoding of the values: <code class="docutils literal notranslate"><span class="pre">(1,0,0)</span></code>, <code class="docutils literal notranslate"><span class="pre">(0,1,0)</span></code>, or <code class="docutils literal notranslate"><span class="pre">(0,0,1)</span></code>.</p>
<p id="slot-features"><strong>Slot features</strong></p>
<p>When Rasa Core runs trains a dialogue model using your stories the presence of a <code class="docutils literal notranslate"><span class="pre">Slot</span></code> entry will be used to help
determine the next action that should be taken. This works best with <code class="docutils literal notranslate"><span class="pre">CategoricalSlot</span></code> slot types.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">TextSlot</span></code> can have any value, but it only has a single feature. It can be set, in which case the feature
has a value <code class="docutils literal notranslate"><span class="pre">(1)</span></code>, or if it is not set it will have a value <code class="docutils literal notranslate"><span class="pre">(0)</span></code>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">CategoricalSlot</span></code> has a number of values each of which is a feature. Taking the example below, when the
<code class="docutils literal notranslate"><span class="pre">restaurant_availability</span></code> slot is set Rasa Core will be able to determine whether or not the restaurant in question is
available and choose radically different actions to perform based on the value.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">restaurant_availability</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">categorical</span>
    <span class="l l-Scalar l-Scalar-Plain">values</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">unknown</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">booked-out</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">waiting-list</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">available</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">Slot</span></code> will be set by Rasa Core if its name and the name of the entity detected by the NLU module
match. The value of the slot will influence the story dialogue if you add the slot to the training
stories - this is explained in the examples below. Slots can also be set explicitly from our own custom <code class="docutils literal notranslate"><span class="pre">Action</span></code>
and influence the dialogue based on real-world information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActionMakeBooking</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="n">restaurant_name</span><span class="o">=</span><span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;restaurant_name&quot;</span><span class="p">)</span>
        <span class="n">location</span><span class="o">=</span><span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
        <span class="n">num_people</span><span class="o">=</span><span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;people&quot;</span><span class="p">)</span>
        <span class="n">date</span><span class="o">=</span><span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
        <span class="c1"># this will fetch the availability of the restaurant from your DB or an API</span>
        <span class="n">availability</span><span class="o">=</span><span class="n">restaurantService</span><span class="o">.</span><span class="n">check_availability</span><span class="p">(</span><span class="n">restaurant_name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;restaurant_availability&quot;</span><span class="p">,</span> <span class="n">availability</span><span class="p">)]</span>
</pre></div>
</div>
<p>The snippet of code above from a hypothetical <code class="docutils literal notranslate"><span class="pre">Action</span></code> shows that the value of the slot <code class="docutils literal notranslate"><span class="pre">restaurant_availability</span></code> is determined by querying a database or API. The restaurant availability is not something that is known when we train the dialogue model, the <code class="docutils literal notranslate"><span class="pre">Slot</span></code> value is the only way we can alter the course of the conversation based on information from the outside world.</p>
<p>The data fetched from an API call can also be stored for later use without altering the outcome of a conversation as detailed in <a class="reference internal" href="#unfeaturized-slots"><span class="std std-ref">Storing API responses in the tracker</span></a>.</p>
<p><strong>Slot Features Example</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These example stories have been constructed manually for illustrative purposes. While this is a valid approach to training your model the preferred approach is to use <a class="reference internal" href="../tutorial_interactive_learning/#tutorial-interactive-learning"><span class="std std-ref">interactive learning</span></a> which generates stories that are <em>much</em> less error-prone.</p>
</div>
<p>In this first story we will try and make a booking for 5 people in a restaurant on the night of 21st August 2018.
In this case the restaurant is booked out so we want to apologize to the customer and suggest similar restaurants. It is assumed that the Rasa Core model has been trained to recognise a message like <em>“Book Murphys Bistro on August 21 for 5 people”</em></p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh">#</span> restaurant unavailable
<span class="k">*</span> _make_booking{&quot;people&quot;:&quot;5&quot;, &quot;date&quot;:&quot;2018-08-21T19:30:00+00:00&quot;, &quot;restaurant_id&quot;:&quot;145&quot;}
<span class="k">-</span> slot{&quot;restaurant_availability&quot;: &quot;booked-out&quot;}
<span class="k">-</span> utter_sorry_unavailable
<span class="k">-</span> action_show_similar
</pre></div>
</div>
<p>This second story details the flow when the restaurant is available. We will tell the customer we have booked
the restaurant and ask if any further help is required.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh">#</span> restaurant available
<span class="k">*</span> _make_booking{&quot;people&quot;:&quot;5&quot;, &quot;date&quot;:&quot;2018-08-22T19:30:00+00:00&quot;, &quot;restaurant_id&quot;:&quot;145&quot;}
<span class="k">-</span> slot{&quot;restaurant_availability&quot;: &quot;available&quot;}
<span class="k">-</span> action_make_booking
<span class="k">-</span> utter_restaurant_booked
<span class="k">-</span> utter_anything_more
<span class="k">*</span> _bye
<span class="k">-</span> utter_thank_you
</pre></div>
</div>
<p>In this last example, the intent <code class="docutils literal notranslate"><span class="pre">make_booking</span></code> was found but either Rasa Core failed to parse a date or the
date was not provided. In this case we would need to ask for more information.</p>
<p><strong>Note:</strong> this last story is using the fact that <code class="docutils literal notranslate"><span class="pre">date</span></code> is a <code class="docutils literal notranslate"><span class="pre">TextSlot</span></code> and therefore has a single feature that
is set or not.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gh">#</span> restaurant request without date
<span class="k">*</span> _make_booking{&quot;people&quot;:&quot;5&quot;, &quot;restaurant_id&quot;:&quot;145&quot;}
<span class="k">-</span> slot{&quot;date&quot;: null}
<span class="k">-</span> utter_date_required
<span class="k">*</span> _inform{&quot;date&quot;:&quot;2018-08-22T19:30:00+00:00&quot;}
<span class="k">-</span> action_make_booking
<span class="k">-</span> utter_restaurant_booked
<span class="k">-</span> utter_anything_more
<span class="k">*</span> _bye
<span class="k">-</span> utter_thank_you
</pre></div>
</div>
</div>
<div class="section" id="storing-api-responses-in-the-tracker">
<span id="unfeaturized-slots"></span><h2>Storing API responses in the tracker<a class="headerlink" href="#storing-api-responses-in-the-tracker" title="Permalink to this headline">¶</a></h2>
<p>The result from an API call can be stored in a <code class="docutils literal notranslate"><span class="pre">Slot</span></code> as <a class="reference internal" href="#slot-features"><span class="std std-ref">explained above</span></a>. In that case
the data is stored in a <code class="docutils literal notranslate"><span class="pre">Slot</span></code> that is featurized, influencing the flow of the dialogue.</p>
<p>A slot of type <code class="docutils literal notranslate"><span class="pre">unfeaturized</span></code> can be used to store the results from a database query or API call so that it will
not influence the course of a dialogue. An exaple <code class="docutils literal notranslate"><span class="pre">unfeaturized</span></code> slot defined in a domain file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">slots</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">api_result</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">unfeaturized</span>
</pre></div>
</div>
<p>You can set this value in a custom <code class="docutils literal notranslate"><span class="pre">Action</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rasa_core.actions</span> <span class="kn">import</span> <span class="n">Action</span>
<span class="kn">from</span> <span class="nn">rasa_core.events</span> <span class="kn">import</span> <span class="n">SlotSet</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">class</span> <span class="nc">ApiAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;api_action&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SlotSet</span><span class="p">(</span><span class="s2">&quot;api_result&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)]</span>
</pre></div>
</div>
<p>This is especially useful when you are <a class="reference internal" href="../state/#persisting-trackers"><span class="std std-ref">persisting your tracker</span></a> in Redis or another data store. You could cache the API or database responses separately, but storing them in the tracker means they will be persisted automatically with the rest of the dialogue state, and will be restored along with the rest of the state should the system require a reboot.</p>
</div>
<div class="section" id="fallback-default-actions">
<h2>Fallback / Default Actions<a class="headerlink" href="#fallback-default-actions" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you want to fall back to a default action like saying “Sorry, I didn’t understand that”.
To do this, add the <code class="docutils literal notranslate"><span class="pre">FallbackPolicy</span></code> to your policy ensemble.
The default action will be executed if the intent recognition has a confidence below <code class="docutils literal notranslate"><span class="pre">nlu_threshold</span></code>
or if none of the dialogue policies predict an action with confidence higher than <code class="docutils literal notranslate"><span class="pre">core_threshold</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rasa_core.policies.fallback</span> <span class="kn">import</span> <span class="n">FallbackPolicy</span>
<span class="kn">from</span> <span class="nn">rasa_core.policies.keras_policy</span> <span class="kn">import</span> <span class="n">KerasPolicy</span>
<span class="kn">from</span> <span class="nn">rasa_core.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">fallback</span> <span class="o">=</span> <span class="n">FallbackPolicy</span><span class="p">(</span><span class="n">fallback_action_name</span><span class="o">=</span><span class="s2">&quot;utter_default&quot;</span><span class="p">,</span>
                          <span class="n">core_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                          <span class="n">nlu_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="s2">&quot;domain.yml&quot;</span><span class="p">,</span>
               <span class="n">policies</span><span class="o">=</span><span class="p">[</span><span class="n">KerasPolicy</span><span class="p">(),</span> <span class="n">fallback</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../plumbing/" class="btn btn-neutral float-right" title="Plumbing - How it all fits together" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../stories/" class="btn btn-neutral" title="Stories - The Training Data" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Rasa Technologies GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.9.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../0.9.6/patterns.html">0.9.6</a></dd>
            <dd><a href="../0.9.5/patterns.html">0.9.5</a></dd>
            <dd><a href="../0.9.4/patterns.html">0.9.4</a></dd>
            <dd><a href="../0.9.3/patterns.html">0.9.3</a></dd>
            <dd><a href="../0.9.2/patterns.html">0.9.2</a></dd>
            <dd><a href="patterns.html">0.9.1</a></dd>
            <dd><a href="../0.9.0/patterns.html">0.9.0</a></dd>
            <dd><a href="../0.8.6/patterns.html">0.8.6</a></dd>
            <dd><a href="../0.7.9/patterns.html">0.7.9</a></dd>
            <dd><a href="../0.6.9/patterns.html">0.6.9</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../docs_reorg/index.html">docs_reorg</a></dd>
            <dd><a href="../master/patterns.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.9.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>

  
  
 
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0074/3851.js" async="async"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments)};
gtag('js', new Date());

gtag('config', 'UA-87333416-1');
</script>


</body>
</html>